---
title: (리팩토링) 코드의 구린내
date: "2019-05-10T10:00:03.284Z"
---

## 중복 코드

중복 코드의 가장 단순한 예는 한 클래스의 두 메서드 안에 같은 코드가 들어 있는 경우 이다.
이럴땐 `메서드 추출` 기법을 적용해서 겹치는 코드를 빼내어 별도의 메서드로 만들고 그 메서드를 두곳에서 호출하면 된다.

또 다른 상황은 한 클래스의 두 하위클래스에 같은 코드가 들어있는 경우다.
이럴 때는 `메서드 추출` 기법을 적용해서 중복을 없앤 후 `메서드 상향` 기법을 적용하면 된다.

코드가 똑같지 않고 비슷하다면 `메서드 추출`기법을 적용해서 같은 부분과 다른 부분을 분리해야 한다.
그런다음, 경우에 따라 템플릿 메서드 형성 기법을 적용해야 할 수도 있다.

두 메서드가 알고리즘만 다르고 기능이 같다면 개발자는 그 두 알고리즘 중에서 더 간단한 것을 택해서 `알고리즘 전환`을 적용하면 된다.
중복코드가 가운데에 있다면 주변 `메서드 추출`을 적용하면 된다.

서로 상관없는 두 클래스 안에 중복 코드가 있을 때는 한 클래스 안의 중복코드를 `클래스 추출`이나 `모듈 추출`을 적용해제 3 의 클래스나 모듈로 떼어낸 후 그것을 다른 클래스에서 호출하는 방법이 있다. 아니면 중복 코드를 빼서 메서드로 만든 후 그 메서드를 두 클래스 중 하나에 넣고 다른 클래스에서 그 메서드를 호출하거나, 코드를 빼내어 만든 메서드를 제 3 의 클래스에 넣고 그걸 두 클래스에서 호출하는 방법도 있다.

## 장황한 메서드

최적의 상태로 장수하는 객체 프로그램을 보면 공통적으로 메서드 길이가 짧다.
주석을 달아야 할 것 같은 부분에 주석을 넣는 대신 메서드를 작성한다. 메서드 안에 주석을 단 코드를 넣고, 그 메서드 명은 기능 수행 방식이 아니라 목적(즉, 기능자체)을 나타내는 이름으로 정한다.

메서드를 줄이려면 십중팔구는 `메서드 추출` 기법을 적용해야 한다. 메서드에서 하나로 묶으면 좋을 만한 부분들을 찾아내어 메서드로 만드는 것이다.

메서드에 매개변수와 임시변수가 많으면 `메서드 추출`을 실시하기가 까다롭다.
메서드 추출을 하려면 수많은 매개변수와 임시변수를 새로 만든 메서드의 매개변수로 넘겨야 하는데, 그렇게 되면 가독성에서 원래의 코드와 별 다를게 없어진다. 웬만한 경우에는 `임시변수를 메서드 호출 전환`기법이나 `임시변수를 메서드 체인으로 전환` 기법을 적용하면 임시변수가 제거된다.
길게 열거된 매개변수는 `매개변수 세트를 객체로 전환` 기법과 `객체를 통째로 전달` 기법을 적용하면 간결해진다.

이런 노력에도 불구하고 임시변수와 매개변수가 너무 많을 때는 `메서드를 메서드 객체로 전환` 기법을 적용하면 된다.

조건문을 추출하려면 `조건문 쪼개기` 기법을 사용해야 한다.
루프를 `컬렉션 클로저 메서드로 전환`을 실시한 후 그 클로저 메서드 호출과 클로저 자체에 `메서드 추출`을 실시하면 된다.

## 방대한 클래스

기능이 지나치게 많은 클래스는 보통 엄청난 수의 인스턴스 변수가 들어 있다.
클래스에 인스턴스 변수가 너무 많으면 중복 코드가 반드시 존재하게 마련이다.

`클래스 추출`을 실시하면 수 많은 인스턴스 변수를 하나로 묶을 수 있다. 쉽게 말해 한 클래스 안의 일부 변수가 접두어나 접미어가 같다면 하나의 클래스로 추출하는게 좋다. `하위클래스로 추출`하는 것이 적합할 것 같으면 `하위클래스 추출`을 실시하는 것이 더 간단하다.
만약 추출할 클래스가 대리자로 부적절할 것 같으면 `모듈 추출`을 실시하면 된다.

인스턴스 변수를 계속해서 모두 사용하지 않는 클래스도 간혹 있다. 그런 경우에는 `클래스 추출`, `모듈 추출`, `하위클래스 추출` 중 하나를 여러번 적용하는 방법도 있다.
만약 100 줄짜리 메서드 5 개가 있다면 그것들을 원래 메서드에서 추출한 2 줄짜리 메서드 10 개가 들어있는 10 줄짜리 메서드 5 개로 바꾸는 방법도 있다.

클라이언트가 그 클래스를 어떻게 사용하게 할지 결정하고, 그러한 각 사용방법마다 `인터페이스 추출`을 실시하는 편법도 자주 쓰인다.

만약 방대한 클래스가 GUI 클래스라면 데이터와 기능을 서로 다른 도메인 객체로 옮겨야 할 수도 있다. 이를 위해 두 곳에 있는 일부 중복 데이터는 놔두고그 데이터와 싱크를 유지해야할 수도 있다. 이것은 `관측 데이터 복제` 기법을 실시하면 해결된다.

## 과다한 매개변수

초보 시절 루틴에 필요한 모든 걸 매개변수를 사용해 전달하라고 배웠지만, 객체의 등장으로 인해 상황은 달라졌다.
필요한 데이터가 없을 때는 그것을 가져오도록 항상 다른 객체에 요청하면 되기 때문이다. 그래서 객체를 사용할 때는 메서드에 필요한 모든 데이터를 전달하는 게 아니라 *그 모든 데이터를 가져올 수 있는 메서드만 전달*하면 된다. 메서드가 필요로 하는 각종 데이터는 그 메서드가 속한 클래스에 들어 있다.

매개변수 세트가 간결하다는 것은 장점이다.

이미 알고 있는 객체에 요청하여 한 매개변수에 들어있는 데이터를 가져올 수 있을 때는 `매개변수 세트를 메서드로 전환`을 적용하면 된다. 이 객체는 인스턴스 변수일 수도 있고 다른 매개변수일 수도 있다.
객체에 있는 데이터 세트를 가져온 후, 데이터 세트를 그 객체 자체로 전환하려면 `객체를 통째로 전달`을 적용하면 된다.
여러 데이터항목에 논리적 객체가 없다면 `매개변수 세트를 객체로 전환`을 적용하면 된다.

이 기법들이 적용할 때 예외가 하나 있는데, 그것은 바로 호출되는 객체가 호출 객체에 의존하면 안 될 때다. 이럴 때는 데이터를 개별적으로 빼서 매개변수로 전달하는 것이 바람직하지만, 그렇게 하려면 어려움이 따른다. 나열된 매개변수 세트가 너무 길거나 자주 바뀐다면 불가피하게 종속 구조를 유지하는 것도 생각해야 한다.

## 수정의 산발

어떤 클래스를 보던 중 '새 데이터베이스를 생성할 때마다 이 3 개의 메서드를 수정해야 하고, 새 금융 상품을 추가할 때마다 이 4 개의 메서드를 수정해야 하네!' 하는 생각이 들면 그 하나의 클래스를 여러 개의 변형 객체로 분리하는 것이 좋다. 그러면 각 객체는 한 종류의 수정에 의해서만 변경된다.
이렇게 변경할 때는 한 개의 클래스나 모듈만 변경해야 하며, 새 클래스나 모듈 안에는 반드시 그 변경사항을 표시해야 한다.
이것을 정리하려면 특정 원인으로 인해 변하는 모든 부분을 찾은 후 `클래스 추출`을 적용해서 그 부분들을 합쳐 한 클래스로 빼내야 한다.

## 기능의 산재

기능의 산재는 수정의 산발과 비슷하지만 정 반대다. 수정할 때마다 여러 클래스에서 수많은 자잘한 부분을 고쳐야 한다면 이 문제를 의심할 수 있다. 수정할 부분이 여기저기에 있다면 찾기도 힘들 뿐더러 꼭 수정해야 하는 부분을 놓치기 쉽다.

이럴 때는 `메서드 이동`과 `필드 이동`을 적용해서 수정할 부분들을 전부 하나의 클래스 안에 넣어야 한다.
기존의 클래스 중 어느 것에 넣기에도 부적절해 보일 때는 새 클래스를 만들어야 한다. 대게는 `클래스 내용 직접 삽입`을 적용해서 별도 클래스에 분산되어 있던 모든 기능을 한 곳으로 가져와도 된다.

## 잘못된 소속

## 데이터 뭉치

## 강박적 기본 타입 사용

## switch 문

## 평행 상속 계층

## 직무유기 클래스

## 막연한 범용 코드

## 임시 필드

## 메시지 체인

## 과잉 중개 메서드

## 지나친 관여

## 인터페이스가 다른 대용 클래스

## 미흡한 라이브러리 클래스

## 데이터 클래스

## 방치된 상속물

## 불필요한 주석
