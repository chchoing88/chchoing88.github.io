<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/ho_blog/component---src-layouts-index-js-60e98b905b7a1c56256e.js" as="script"/><link rel="preload" href="/ho_blog/component---src-templates-blog-post-js-dabe65ee189101b630a0.js" as="script"/><link rel="preload" href="/ho_blog/path---react-fiber-react-fiber-03-29e733efaa17068c8d71.js" as="script"/><link rel="preload" href="/ho_blog/app-a16cf49ffcd7b97d28a9.js" as="script"/><link rel="preload" href="/ho_blog/commons-241c3561f1c9cf4619a9.js" as="script"/><style id="glamor-styles"></style><script id="glamor-ids">
        // <![CDATA[
        window._glamor = []
        // ]]>
        </script><link rel="alternate" type="application/rss+xml" href="/ho_blog/rss.xml"/><title data-react-helmet="true">React Fiber part3 | Merlin Tec Blog</title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:106.25%/1.53 'Source Sans Pro',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Source Sans Pro',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;color:inherit;font-family:'Merriweather',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2rem;line-height:2.295rem;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;color:inherit;font-family:'Merriweather',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:2.295rem;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;color:inherit;font-family:'Merriweather',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.1487rem;line-height:1.53rem;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;color:inherit;font-family:'Merriweather',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.53rem;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;color:inherit;font-family:'Merriweather',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.917rem;line-height:1.53rem;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;color:inherit;font-family:Source Sans Pro,sans-serif;font-weight:400;text-rendering:optimizeLegibility;font-size:0.8409rem;line-height:1.53rem;text-transform:uppercase;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}ul{margin-left:1.53rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.53rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;font-size:0.85rem;line-height:1.42;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.53rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;font-size:1rem;line-height:1.53rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}blockquote{margin-left:1.53rem;margin-right:1.53rem;margin-top:0;padding-bottom:0.51rem;padding-left:1.02rem;padding-right:1.02rem;padding-top:0.51rem;margin-bottom:1.53rem;font-size:1.18921rem;line-height:1.53rem;border-left:0.255rem solid;border-color:hsla(0,0%,0%,0.07);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.53rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.53rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.53rem;margin-bottom:calc(1.53rem / 2);margin-top:calc(1.53rem / 2);}li > ul{margin-left:1.53rem;margin-bottom:calc(1.53rem / 2);margin-top:calc(1.53rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.53rem / 2);}code{font-size:0.85rem;line-height:1.53rem;}kbd{font-size:0.85rem;line-height:1.53rem;}samp{font-size:0.85rem;line-height:1.53rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.02rem;padding-right:1.02rem;padding-top:0.765rem;padding-bottom:calc(0.765rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;}pre code{background:none;line-height:1.42;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:"Â ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:none;}a{color:#0071bc;text-decoration:none;}a:visited{color:#4c2c92;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.53rem;color:hsla(204,5.275997423999999%,0%,0.46);font-weight:400;font-style:normal;}div.gatsby-highlight{margin-bottom:20px;}</style><link href="//fonts.googleapis.com/css?family=Merriweather:700|Source+Sans+Pro:400,400i,700" rel="stylesheet" type="text/css"/><style id="gatsby-inlined-css">.editor .wrap-guide{background:hsla(0,0%,100%,.1)}.editor .indent-guide{color:hsla(0,0%,100%,.15)}.editor,.editor .gutter{background-color:#282828;color:#f8f8f2}.editor.is-focused .cursor{border-color:#f8f8f0}.editor.is-focused .line-number.cursor-line-no-selection,.editor.is-focused .selection .region{background-color:#49483e}.editor .invisible-character{color:hsla(0,0%,84%,.15)}.editor .comment{color:#75715e}.editor .string{color:#e6db74}.editor .constant.character,.editor .constant.language,.editor .constant.numeric,.editor .constant.other{color:#ae81ff}.editor .keyword,.editor .storage{color:#f92672}.editor .storage.type{font-style:italic;color:#66d9ef}.editor .entity.name.class,.editor .entity.other.inherited-class{text-decoration:underline;color:#a6e22e}.editor .entity.other.inherited-class{font-style:italic}.editor .entity.name.function{color:#a6e22e}.editor .entity.name.instance{color:#66d9ef}.editor .variable.parameter{font-style:italic;color:#fd971f}.editor .entity.name.tag{color:#f92672}.editor .entity.other.attribute-name{color:#a6e22e}.editor .support.constant,.editor .support.function{color:#66d9ef}.editor .support.class,.editor .support.type{font-style:italic;color:#66d9ef}.editor .invalid{color:#f8f8f0;background-color:#f92672}.editor .invalid.deprecated{color:#f8f8f0;background-color:#ae81ff}.editor .class.jade{color:#ae81ff}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/ho_blog/static/montserrat-latin-100.50d27986.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-100.5e334eff.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/ho_blog/static/montserrat-latin-100italic.8c070533.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-100italic.03e19243.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/ho_blog/static/montserrat-latin-200.4343d3d9.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-200.f2022ecd.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/ho_blog/static/montserrat-latin-200italic.116c4c4b.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-200italic.89614a60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/ho_blog/static/montserrat-latin-300.d2ad295b.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-300.3a371ee0.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/ho_blog/static/montserrat-latin-300italic.f6b6bf24.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-300italic.16521668.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/ho_blog/static/montserrat-latin-400.240a8444.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-400.b20cc131.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/ho_blog/static/montserrat-latin-400italic.86172bb8.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-400italic.9405e787.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/ho_blog/static/montserrat-latin-500.fb8d6b71.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-500.50825d47.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/ho_blog/static/montserrat-latin-500italic.c0a555a4.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-500italic.635de59c.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/ho_blog/static/montserrat-latin-600.d5615136.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-600.f300da4f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/ho_blog/static/montserrat-latin-600italic.10f29d13.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-600italic.2bc37d86.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/ho_blog/static/montserrat-latin-700.7d77e1f0.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-700.81826529.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/ho_blog/static/montserrat-latin-700italic.1dd2b53f.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-700italic.c162d257.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/ho_blog/static/montserrat-latin-800.d4e7bf86.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-800.895aadbf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/ho_blog/static/montserrat-latin-800italic.fc0cbe44.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-800italic.b3362875.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/ho_blog/static/montserrat-latin-900.c8bdd772.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-900.1b99ef78.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/ho_blog/static/montserrat-latin-900italic.cb72c1f9.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-900italic.b78bb9f8.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/ho_blog/static/merriweather-latin-300.f015f1e9.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-300.92dfe81b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/ho_blog/static/merriweather-latin-300italic.7fd86b32.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-300italic.878b76f5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/ho_blog/static/merriweather-latin-400.12dbf4c0.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-400.1fffad22.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/ho_blog/static/merriweather-latin-400italic.1e0d3e81.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-400italic.de18d4c4.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/ho_blog/static/merriweather-latin-700.dc8fec81.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-700.d7d2ed8e.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/ho_blog/static/merriweather-latin-700italic.b7b7e5da.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-700italic.6210a5fc.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/ho_blog/static/merriweather-latin-900.43f870d5.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-900.8f3806df.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/ho_blog/static/merriweather-latin-900italic.168c1ab2.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-900italic.ae7778f0.woff) format("woff")}</style></head><body><div id="___gatsby"><div style="max-width:52.02rem;margin-left:auto;margin-right:auto;padding:2.295rem 1.1475rem;" data-reactroot="" data-reactid="1" data-react-checksum="-1925239701"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;" data-reactid="2"><a style="box-shadow:none;text-decoration:none;color:inherit;" href="/ho_blog/" data-reactid="3">Merlin Tec Blog</a></h3><div data-reactid="4"><!-- react-empty: 5 --><h1 data-reactid="6">React Fiber part3</h1><p style="font-size:0.87055rem;line-height:1.53rem;display:block;margin-bottom:1.53rem;margin-top:-1.53rem;" data-reactid="7">July 22, 2019</p><div data-reactid="8"><p><a href="https://medium.com/react-in-depth/in-depth-explanation-of-state-and-props-update-in-react-51ab94563311">ì´ê¸</a>ì ë²ì­ ë° ë¶ì í ê¸ìëë¤. ìëª»ë ë²ì­ ë° ìëµë ë²ì­ì´ ìì ì ììµëë¤.</p>
<h1>In-depth explanation of state and props update in React</h1>
<p>ì´ì  ê¸°ì¬ ì¸ <a href="https://medium.com/react-in-depth/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react-e1c04700ef6e?source=post_page---------------------------">Inside Fiber: in-depth overview of the new reconciliation algorithm in React</a> ììë ì´ ê¸°ì¬ìì ì¤ëª í  ìë°ì´í¸ íë¡ì¸ì¤ì ê¸°ì ì  ì¸ë¶ ì¬í­ì ì´í´íë ë° íìí ê¸°ë°ì ë§ë ¨íìµëë¤.</p>
<p>íìë ì´ ê¸°ì¬ìì ì¬ì©í  ì£¼ì ë°ì´í° êµ¬ì¡° ë° ê°ë, í¹í fiber ë¸ë, current ë° work-in-progress í¸ë¦¬, side-effects ë° effects list ì ëí´ ì¤ëªíìµëë¤. ëí ì£¼ì ìê³ ë¦¬ì¦ì ëí ëì ìì¤ì ê°ìë¥¼ ì ê³µíê³  ë ëë§ ë° ì»¤ë° ë¨ê³ì ì°¨ì´ì ì ì¤ëªíìµëë¤. ê·¸ê²ì ì½ì§ ììë¤ë©´ ê±°ê¸°ìì ììíë ê²ì´ ì¢ìµëë¤.</p>
<p>ëí íë©´ì ë ëë§ ë ì«ìë¥¼ ë¨ìí ì¦ê°ìí¤ë ë²í¼ì ì¬ì©íì¬ ìí ì íë¦¬ì¼ì´ìì ìê°íìµëë¤.</p>
<p><a href="https://stackblitz.com/edit/react-jwqn64?source=post_page---------------------------">ì¬ê¸°</a>ìì í´ë³¼ ì ììµëë¤. ì´ë render ë©ìëìì ë ê°ì íì ìì button ë° span ì ë°ííë ê°ë¨í êµ¬ì± ììë¡ êµ¬íë©ëë¤. ë²í¼ì í´ë¦­íë©´ êµ¬ì± ììì ìíê° í¸ë¤ë¬ ë´ë¶ìì ìë°ì´í¸ë©ëë¤. <code>span</code> ììì ëí íì¤í¸ ìë°ì´í¸ ê²°ê³¼ë ë¤ìê³¼ ê°ìµëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta class js"><span class="storage type class js"><span>class</span></span><span>&nbsp;</span><span class="entity name type class js"><span>ClickCounter</span></span><span>&nbsp;</span><span class="storage modifier js"><span>extends</span></span><span>&nbsp;</span><span class="entity other inherited-class js"><span>React</span></span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>Component</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function js"><span class="entity name function constructor js"><span>constructor</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>props</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable language js"><span>super</span></span><span class="meta brace round js"><span>(</span></span><span>props</span><span class="meta brace round js"><span>)</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable language js"><span>this</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>state</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>&nbsp;count</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>0</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable language js"><span>this</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>handleClick</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable language js"><span>this</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other object property js"><span>handleClick</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>bind</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="variable language js"><span>this</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function method definition js"><span class="entity name function js"><span>handleClick</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable language js"><span>this</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>setState</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="meta function arrow js"><span class="meta parameters js"><span class="variable parameter function js"><span>state</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>&nbsp;count</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="variable other object js"><span>state</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>count</span></span><span>&nbsp;</span><span class="keyword operator js"><span>+</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>1</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function method definition js"><span class="entity name function js"><span>componentDidUpdate</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function method definition js"><span class="entity name function js"><span>render</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator comparison js"><span>&lt;</span></span><span>button&nbsp;key</span><span class="keyword operator assignment js"><span>=</span></span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>1</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span>&nbsp;onClick</span><span class="keyword operator assignment js"><span>=</span></span><span class="meta brace curly js"><span>{</span></span><span class="variable language js"><span>this</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>handleClick</span></span><span class="meta brace curly js"><span>}</span></span><span class="keyword operator comparison js"><span>&gt;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Update&nbsp;counter</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator comparison js"><span>&lt;</span></span><span class="keyword operator js"><span>/</span></span><span>button</span><span class="keyword operator comparison js"><span>&gt;</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator comparison js"><span>&lt;</span></span><span>span&nbsp;key</span><span class="keyword operator assignment js"><span>=</span></span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>2</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="keyword operator comparison js"><span>&gt;</span></span><span class="meta brace curly js"><span>{</span></span><span class="variable language js"><span>this</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other object property js"><span>state</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>count</span></span><span class="meta brace curly js"><span>}</span></span><span class="keyword operator comparison js"><span>&lt;</span></span><span class="keyword operator js"><span>/</span></span><span>span</span><span class="keyword operator comparison js"><span>&gt;</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace square js"><span>]</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>ì¬ê¸°ììë <code>componentDidUpdate</code> ë¼ì´í ì¬ì´í´ ë©ìëë¥¼ êµ¬ì± ììì ì¶ê°íìµëë¤. ì´ê²ì React ê° <code>ì»¤ë° ë¨ê³</code>ìì ì´ ë©ìëë¥¼ í¸ì¶íë <a href="https://medium.com/react-in-depth/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react-e1c04700ef6e">effects</a>ë¥¼ ì¶ê°íë ë°©ë²ì ë³´ì¬ì£¼ê¸° ìí´ íìí©ëë¤.</p>
<p>ì´ ê¸ììë React íë¡ì¸ì¤ state ìë°ì´í¸ ë° effects list ìì± ë°©ë²ì ìë ¤ ëë¦¬ê³ ì í©ëë¤. <code>ë ëë§</code> ë° <code>ì»¤ë° ë¨ê³</code>ì ê³ ê¸ ê¸°ë¥ìì ì§íì¤ì¸ ììì ì´í´ ââ ë´ëë¤.
í¹í, ì°ë¦¬ë React <code>completeWork</code>ìì ì´ë»ê² ìëíëì§ ë³¼ê²ìëë¤.</p>
<ul>
<li><code>ClickCounter</code>ì <code>state</code>ìì <code>count</code> ìì±ì ìë°ì´í¸í©ëë¤.</li>
<li><code>render</code> ë©ìëë¥¼ í¸ì¶íì¬ children ëª©ë¡ì ê°ì ¸ ìì ë¹êµë¥¼ ìíí©ëë¤.</li>
<li><code>span</code> ììì ëí props ì ìë°ì´í¸í©ëë¤.</li>
</ul>
<p>ê·¸ë¦¬ê³ , <code>commitRoot</code>ìì React :</p>
<ul>
<li><code>span</code> ììì <code>textContent</code> ìì±ì ìë°ì´í¸í©ëë¤.</li>
<li><code>componentDidUpdate</code> ë¼ì´í ì¬ì´í´ ë©ìëë¥¼ í¸ì¶í©ëë¤.</li>
</ul>
<p>ê·¸ë¬ë ê·¸ ì ì <code>click</code> í¸ë¤ë¬ìì <code>setState</code>ë¥¼ í¸ì¶ í  ë ìì ì¼ì ì ë¹ ë¥´ê² ì´í´ ë³´ê² ìµëë¤.</p>
<p><strong>React ë¥¼ ì¬ì©íê¸° ìí´ ê·¸ê±¸ ì íìë ììµëë¤. ì´ ê¸°ì¬ë React ê° ë´ë¶ì ì¼ë¡ ì´ë»ê² ìëíëì§ì ëí ê²ìëë¤.</strong></p>
<h2>Render phase</h2>
<h3>Scheduling updates</h3>
<p>ë²í¼ì í´ë¦­íë©´ <code>click</code> ì´ë²¤í¸ê° í¸ë¦¬ê±°ëê³  React ë button props ë¡ ì ë¬í ì½ë°±í¨ìë¥¼ ì¤íí©ëë¤. ì°ë¦¬ì ìì© íë¡ê·¸ë¨ììë ë¨ìí ì¹´ì´í°ë¥¼ ì¦ê°ìí¤ê³  ìíë¥¼ ìë°ì´í¸í©ëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta class js"><span class="storage type class js"><span>class</span></span><span>&nbsp;</span><span class="entity name type class js"><span>ClickCounter</span></span><span>&nbsp;</span><span class="storage modifier js"><span>extends</span></span><span>&nbsp;</span><span class="entity other inherited-class js"><span>React</span></span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>Component</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function method definition js"><span class="entity name function js"><span>handleClick</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable language js"><span>this</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>setState</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="meta function arrow js"><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>state</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>count</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="variable other object js"><span>state</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>count</span></span><span>&nbsp;</span><span class="keyword operator js"><span>+</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>1</span></span><span class="meta brace curly js"><span>}</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>ëª¨ë  React component ìë component ì React ì½ì´ ì¬ì´ì ë¤ë¦¬ ì­í ìíë ì°ê²°ë <code>updater</code>ê° ììµëë¤. ì´ë¥¼ íµí´ setState ê° ReactDOM, React Native, ìë² ì¸¡ ë ëë§ ë° íì¤í¸ ì í¸ë¦¬í°ì ìí´ ë¤ë¥´ê² êµ¬í ë  ì ììµëë¤.</p>
<p><a href="https://github.com/facebook/react/blob/b87aabdfe1b7461e7331abb3601d9e6bb27544bc/packages/react/src/ReactBaseClasses.js">ì¬ê¸°</a>ì°¸ì¡°</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="variable other object js"><span>Component</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property js"><span>prototype</span></span><span class="meta function js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>setState</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="storage type function js"><span>function</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>partialState</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>callback</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>invariant</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator typeof js"><span>typeof</span></span><span>&nbsp;partialState&nbsp;</span><span class="keyword operator comparison js"><span>===</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>object</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator logical js"><span>||</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator typeof js"><span>typeof</span></span><span>&nbsp;partialState&nbsp;</span><span class="keyword operator comparison js"><span>===</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>function</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator logical js"><span>||</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;partialState&nbsp;</span><span class="keyword operator comparison js"><span>==</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>setState(...):&nbsp;takes&nbsp;an&nbsp;object&nbsp;of&nbsp;state&nbsp;variables&nbsp;to&nbsp;update&nbsp;or&nbsp;a&nbsp;</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator js"><span>+</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>function&nbsp;which&nbsp;returns&nbsp;an&nbsp;object&nbsp;of&nbsp;state&nbsp;variables.</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="variable language js"><span>this</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other object property js"><span>updater</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>enqueueSetState</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="variable language js"><span>this</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;partialState</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;callback</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>setState</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>classComponentUpdater</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;isMounted</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function method definition js"><span class="entity name function js"><span>enqueueSetState</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>inst</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>payload</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>callback</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>fiber</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>ReactInstanceMap</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="support function dom js"><span>get</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>inst</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>currentTime</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>requestCurrentTime</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>expirationTime</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>computeExpirationForFiber</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>currentTime</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;fiber</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>update</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>createUpdate</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>expirationTime</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>update</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>payload</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;payload</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>callback&nbsp;</span><span class="keyword operator comparison js"><span>!==</span></span><span>&nbsp;</span><span class="constant language js"><span>undefined</span></span><span>&nbsp;</span><span class="keyword operator logical js"><span>&amp;&amp;</span></span><span>&nbsp;callback&nbsp;</span><span class="keyword operator comparison js"><span>!==</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="constant other js"><span>__DEV__</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>warnOnInvalidCallback</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>callback</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>setState</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>update</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>callback</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;callback</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>enqueueUpdate</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>fiber</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;update</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>scheduleWork</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>fiber</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;expirationTime</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>ì´ ê¸ììë Fiber reconciler ë¥¼ ì¬ì©íë ReactDOM ì updater ê°ì²´ êµ¬íì ì´í´ ë³´ê² ìµëë¤. <code>ClickCounter</code> êµ¬ì± ììì ê²½ì° <a href="https://github.com/facebook/react/blob/6938dcaacbffb901df27782b7821836961a5b68d/packages/react-reconciler/src/ReactFiberClassComponent.js?source=post_page---------------------------#L186"><code>classComponentUpdater</code></a>ìëë¤. ì´ë Fiber ì ì¸ì¤í´ì¤ë¥¼ ê²ìíê³ , ìë°ì´í¸ë¥¼ ëê¸°ì´ì ë£ì´ëê³ , ììì ìì½íë(scheduling) ì­í ìí©ëë¤.</p>
<p>ìë°ì´í¸ê° ëê¸°ì´ì ìì¼ë©´ ê¸°ë³¸ì ì¼ë¡ ìë°ì´í¸ íì ì¶ê°ëì´ fiber ë¸ëìì ì²ë¦¬ë©ëë¤. ì¬ê¸°ìë <code>ClickCounter</code> êµ¬ì± ììì í´ë¹íë Fibre ë¸ëì êµ¬ì¡°ë ë¤ìê³¼ ê°ìµëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;stateNode</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta class instance constructor js"><span class="keyword operator new js"><span>new</span></span><span>&nbsp;</span><span class="entity name type instance js"><span>ClickCounter</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;type</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;ClickCounter</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;updateQueue</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;baseState</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>count</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>0</span></span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;firstUpdate</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function arrow json js"><span class="entity name function js"><span>payload</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>state</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span><span>&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>count</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="variable other object js"><span>state</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>count</span></span><span>&nbsp;</span><span class="keyword operator js"><span>+</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>1</span></span><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>ë³´ìë¤ìí¼ <code>updateQueue.firstUpdate.next.payload</code>ì í¨ìë <code>ClickCounter</code> êµ¬ì± ììì <code>setState</code>ì ì ë¬í ì½ë°±í¨ììëë¤. <code>ë ëë§ ë¨ê³</code>ìì ì²ë¦¬í´ì¼íë ì²« ë²ì§¸ ìë°ì´í¸ë¥¼ ëíëëë¤.</p>
<h3>Processing updates for the ClickCounter Fiber node</h3>
<p><a href="https://medium.com/react-in-depth/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react-e1c04700ef6e">ì´ì  ê¸°ì¬ì ìì ë£¨í ì¥</a>ììë <code>nextUnitOfWork</code> ì ì­ ë³ìì ì­í ì ëí´ ì¤ëªíìµëë¤. í¹í, ì´ ë³ìëí´ì¼ í  ì¼ì´ìë <code>workInProgress</code> í¸ë¦¬ìì Fibre ë¸ëì ëí ì°¸ì¡°ë¥¼ ë³´ì íê³  ììì ëíëëë¤. React ê° Fibers í¸ë¦¬ë¥¼ íìíë©´ìì´ ë³ìë¥¼ ì¬ì©íì¬ ìë£ëì§ ìì ë¤ë¥¸ Fiber ë¸ëê° ìëì§ íì¸í©ëë¤.</p>
<p><code>setState</code> ë©ìëê° í¸ì¶ëìë¤ê³  ê°ì  í´ ë³´ê² ìµëë¤. React ë <code>setState</code>ì ì½ë°±ì <code>ClickCounter</code> fiber ë¸ëì <code>updateQueue</code> íë¡í¼í°ì ì¶ê°íê³  ìì ì¼ì ì ì¡°ì í©ëë¤. React ë <code>ë ëë§ ë¨ê³</code>ì ë¤ì´ê°ëë¤. <a href="https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js?source=post_page---------------------------#L1132">renderRoot</a> í¨ìë¥¼ ì¬ì©íì¬ ìµìì <code>HostRoot</code> Fibre ë¸ëììë¶í° ì´ëì ììí©ëë¤. ê·¸ë¬ë ììì´ ìë£ëì§ ìì ë¸ëë¥¼ ì°¾ì ëê¹ì§ ì´ë¯¸ ì²ë¦¬ ë fiber ë¸ëë¥¼ ë²ì´ë©ëë¤ (ê±´ë ëëë¤). ì´ ìì ìì í´ì¼ í  ììì´ íëë§ìë Fibre ë¸ëê° ììµëë¤. ê·¸ê²ì <code>ClickCounter</code> Fiber ë¸ëìëë¤.</p>
<p>ëª¨ë  ììì <code>alternate</code> íëì ì ì¥ëë ì´ Fiber ë¸ëì ë³µì ë³¸ìì ìíë©ëë¤. alternate ë¸ëê° ìì§ ìì±ëì§ ìì ê²½ì° React ë ê°±ì ì ì²ë¦¬íê¸° ì ì <code>createWorkInProgress</code> í¨ììì ì¬ë³¸ì ìì±í©ëë¤. ë³ì nextUnitOfWork ê° alternate <code>ClickCounter</code> Fibre ë¸ëì ëí ì°¸ì¡°ë¥¼ ë³´ì íë¤ê³  ê°ì  í´ ë´ìë¤.</p>
<h3>beginWork</h3>
<p>ì²«ì§¸, ì°ë¦¬ì Fiber ë <a href="https://github.com/facebook/react/blob/cbbc2b6c4d0d8519145560bd8183ecde55168b12/packages/react-reconciler/src/ReactFiberBeginWork.js?source=post_page---------------------------#L1489">beginWork</a> í¨ìì ë¤ì´ê°ëë¤.</p>
<blockquote>
<p>ì´ í¨ìë í¸ë¦¬ì ëª¨ë  Fiber ë¸ëì ëí´ ì¤íëê¸° ëë¬¸ì <code>ë ëë§ ë¨ê³</code>ë¥¼ ëë²ê·¸íë ¤ë ê²½ì° ì¤ë¨ ì ì ë£ë ê²ì´ ì¢ìµëë¤. ëë ì´ê²ì ìì£¼íê³  fiber ë¸ëì íìì ì ê²íì¬ íìí ê³³ì ì¤ë¨ì ì ê³ ì ìíµëë¤.</p>
</blockquote>
<p><code>beginWork</code> í¨ìë ê¸°ë³¸ì ì¼ë¡ tag ì ìí´ Fibre ë¸ëì ëí´ ìíí´ì¼íë ìì ì íì ê²°ì í ë¤ì í´ë¹ í¨ìë¥¼ ì¤ííì¬ ììì ìííë í° <code>switch</code> ë¬¸ìëë¤. <code>CountClicks</code>ì ê²½ì° í´ëì¤ êµ¬ì± ììì´ë¯ë¡ ì´ ë¶ê¸°ê° ìíë©ëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>beginWork</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>current$$1</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>workInProgress</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta switch-statement js"><span class="keyword control switch js"><span>switch</span></span><span>&nbsp;</span><span class="punctuation definition switch-expression begin bracket round js"><span>(</span></span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>tag</span></span><span class="punctuation definition switch-expression end bracket round js"><span>)</span></span><span>&nbsp;</span><span class="punctuation definition section switch-block begin bracket curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>FunctionalComponent</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>ClassComponent</span><span class="punctuation definition section case-statement js"><span>:</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>updateClassComponent</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>current$$1</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>HostComponent</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>}</span></span></span></div></pre>
<p>ì°ë¦¬ë <code>updateClassComponent</code> í¨ìë¥¼ ì¬ì©í©ëë¤. component, ìì ì¬ê° ì¤ ì²« ë²ì§¸ ë ëë§ì¸ì§ ëë React ìë°ì´í¸ ì¸ì§ ì¬ë¶ì ë°ë¼ React ë ì¸ì¤í´ì¤ë¥¼ ë§ë¤ê³  í´ë¹ component ë¥¼ mount íê±°ë ë¨ìí ìë°ì´í¸í©ëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>updateClassComponent</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>current</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>workInProgress</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>Component</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>instance</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>stateNode</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type var js"><span>let</span></span><span>&nbsp;shouldUpdate</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>instance&nbsp;</span><span class="keyword operator comparison js"><span>===</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;In&nbsp;the&nbsp;initial&nbsp;pass&nbsp;we&nbsp;might&nbsp;need&nbsp;to&nbsp;construct&nbsp;the&nbsp;instance.</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>constructClassInstance</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;Component</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>mountClassInstance</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;Component</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shouldUpdate&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="constant language boolean true js"><span>true</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>else</span></span><span>&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>current&nbsp;</span><span class="keyword operator comparison js"><span>===</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;In&nbsp;a&nbsp;resume,&nbsp;we&#39;ll&nbsp;already&nbsp;have&nbsp;an&nbsp;instance&nbsp;we&nbsp;can&nbsp;reuse.</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shouldUpdate&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>resumeMountClassInstance</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;Component</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>else</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shouldUpdate&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>updateClassInstance</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>current</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>finishClassComponent</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>current</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;Component</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;shouldUpdate</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<h3>Processing updates for the ClickCounter Fiber</h3>
<p>ì°ë¦¬ë ì´ë¯¸ <code>ClickCounter</code> ì»´í¬ëí¸ì ì¸ì¤í´ì¤ë¥¼ ê°ì§ê³  ìì¼ë¯ë¡ <a href="https://github.com/facebook/react/blob/6938dcaacbffb901df27782b7821836961a5b68d/packages/react-reconciler/src/ReactFiberClassComponent.js?source=post_page---------------------------#L976"><code>updateClassInstance</code></a>ë¡ ë¤ì´ê°ëë¤. ê·¸ê³³ì´ React ê° í´ëì¤ component ì ëí ëë¶ë¶ì ììì ìííë ê³³ìëë¤. ë¤ìì ì¤í ììëë¡ í¨ììì ìí ë ê°ì¥ ì¤ìí ì°ì°ìëë¤.</p>
<ul>
<li><code>UNSAFE_componentWillReceiveProps()</code> hook (ë ì´ì ì¬ì©ëì§ ìì) í¸ì¶</li>
<li><code>updateQueue</code>ìì ìë°ì´í¸ë¥¼ ì²ë¦¬íê³  ì ìíë¥¼ ìì±í©ëë¤. <code>updateQueue.firstUpdate.next.payload</code> ì ë¤ì´ê°ìë ì½ë°±í¨ì</li>
<li>ì´ ìë¡ì´ ìíë¡ <code>getDerivedStateFromProps</code>ë¥¼ í¸ì¶íê³  ê²°ê³¼ë¥¼ ì»ìµëë¤.</li>
<li><code>shouldComponentUpdate</code>ë¥¼ í¸ì¶íì¬ component ê° ìë°ì´í¸íë ¤ê³ íëì§ íì¸í©ëë¤. <code>false</code>ì ê²½ì°,ì´ ì»´í¼ëí¸ì ê·¸ ìì´ì ë ëë§ì í¸ì¶íë ê²ì í¬í¨ í´, ëª¨ë  ë ëë§ ì²ë¦¬ë¥¼ ì¤íµí©ëë¤. ê·¸ë ì§ ìì¼ë©´ ìë°ì´í¸ ì§íí©ëë¤.</li>
<li><code>UNSAFE_componentWillUpdate</code> í¸ì¶ (ë ì´ì ì¬ì©ëì§ ìì)</li>
<li><code>componentDidUpdate</code> ë¼ì´í ì¬ì´í´ hook í¸ë¦¬ê±°ë¥¼ effect ì ì¶ê°í©ëë¤.</li>
</ul>
<blockquote>
<p><code>componentDidUpdate</code>ë¥¼ í¸ì¶íë í¨ê³¼ë <code>ë ëë§ ë¨ê³</code>ìì ì¶ê°ëì§ë§ ë©ìëë ë¤ì <code>ì»¤ë° ë¨ê³</code>ìì ì¤íë©ëë¤.</p>
</blockquote>
<ul>
<li>component ì¸ì¤í´ì¤ìì <code>state</code> ë° <code>props</code> ì ìë°ì´í¸í©ëë¤.</li>
</ul>
<blockquote>
<p><code>render</code> ë©ìë output ì ëê° <code>state</code> ë° <code>props</code>ì ë°ë¼ ë¤ë¥´ê¸° ëë¬¸ì <code>state</code> ë° <code>props</code> ë <code>render</code> ë©ìëê° í¸ì¶ëê¸° ì ì component ì¸ì¤í´ì¤ìì ìë°ì´í¸í´ì¼í©ëë¤. ì°ë¦¬ê° ê·¸ë ê²íì§ ìì¼ë©´, ë§¤ë² ëì¼í ì¶ë ¥ì ë°í í  ê²ìëë¤.</p>
</blockquote>
<p>ë¤ìì í¨ìì ë¨ìí ë ë²ì ìëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>updateClassInstance</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>current</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>workInProgress</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>ctor</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>newProps</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>instance</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>stateNode</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>oldProps</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>memoizedProps</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>instance</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>props</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;oldProps</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>oldProps&nbsp;</span><span class="keyword operator comparison js"><span>!==</span></span><span>&nbsp;newProps</span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>callComponentWillReceiveProps</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;instance</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;newProps</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;updateQueue.firstUpdate.next.payload</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type var js"><span>let</span></span><span>&nbsp;updateQueue&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>updateQueue</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>updateQueue&nbsp;</span><span class="keyword operator comparison js"><span>!==</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>processUpdateQueue</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;updateQueue</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newState&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>memoizedState</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>applyDerivedStateFromProps</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;newState&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>memoizedState</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>shouldUpdate</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>checkShouldComponentUpdate</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;ctor</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>shouldUpdate</span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>instance</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>componentWillUpdate</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>newProps</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;newState</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;nextContext</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>effectTag</span></span><span>&nbsp;</span><span class="keyword operator assignment compound bitwise js"><span>|=</span></span><span>&nbsp;Update</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>effectTag</span></span><span>&nbsp;</span><span class="keyword operator assignment compound bitwise js"><span>|=</span></span><span>&nbsp;Snapshot</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>instance</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>props</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;newProps</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>instance</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>state</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;newState</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;shouldUpdate</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<p>ìì ì¤ëí«ìì ì¼ë¶ ë³´ì¡° ì½ëë¥¼ ì ê±°íìµëë¤. ìë¥¼ ë¤ì´ lifecycle ë©ìëë¥¼ í¸ì¶íê±°ë í¸ë¦¬ê±°íê¸° ìí´ effect ì ì¶ê°íê¸° ì ì React ë <code>typeof</code> ì°ì°ìë¥¼ ì¬ì©íì¬ component ê° ë©ìëë¥¼ êµ¬íëìëì§ íì¸í©ëë¤. ìë¥¼ ë¤ì´, React ê° effect ë¥¼ ì¶ê°íê¸° ì ì <code>componentDidUpdate</code> ë©ìëë¥¼ ê²ì¬íë ë°©ë²ì ë¤ìê³¼ ê°ìµëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="keyword operator typeof js"><span>typeof</span></span><span>&nbsp;</span><span class="variable other object js"><span>instance</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>componentDidUpdate</span></span><span>&nbsp;</span><span class="keyword operator comparison js"><span>===</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>function</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>effectTag</span></span><span>&nbsp;</span><span class="keyword operator assignment compound bitwise js"><span>|=</span></span><span>&nbsp;Update</span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>ì´ì ë <code>ë ëë§ ë¨ê³</code>ìì <code>ClickCounter</code> Fiber ë¸ëì ëí´ ì´ë¤ ììì´ ìíëëì§ ìììµëë¤. ì´ì  ì´ë¬í ììì´ fiber ë¸ëìì ê°ì ë³ê²½íë ë°©ë²ì ì´í´ ë³´ê² ìµëë¤. React ê° ììëë©´ <code>ClickCounter</code> component ì Fibre ë¸ëë ë¤ìê³¼ ê°ìµëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;effectTag</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>0</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;elementType</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta class js"><span class="storage type class js"><span>class</span></span><span>&nbsp;</span><span class="entity name type class js"><span>ClickCounter</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;firstEffect</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;memoizedState</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>count</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>0</span></span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;type</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta class js"><span class="storage type class js"><span>class</span></span><span>&nbsp;</span><span class="entity name type class js"><span>ClickCounter</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;stateNode</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;instance</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>count</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>0</span></span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;updateQueue</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;baseState</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>count</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>0</span></span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;firstUpdate</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function arrow json js"><span class="entity name function js"><span>payload</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>state</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>props</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span><span>â¦</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>ììì´ ìë£ëë©´ ë¤ìê³¼ ê°ì Fiber ë¸ëê° ìê¹ëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;effectTag</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>4</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;ë³ê²½&nbsp;Update</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;elementType</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta class js"><span class="storage type class js"><span>class</span></span><span>&nbsp;</span><span class="entity name type class js"><span>ClickCounter</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;firstEffect</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;memoizedState</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>count</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>1</span></span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;ë³ê²½</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;type</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta class js"><span class="storage type class js"><span>class</span></span><span>&nbsp;</span><span class="entity name type class js"><span>ClickCounter</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;stateNode</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;instance</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>count</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>1</span></span><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;ë³ê²½</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;updateQueue</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;baseState</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>count</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>1</span></span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;ë³ê²½</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;firstUpdate</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p><strong>ì ì ìê°ìë´ì´ íë¡í¼í° ê°ì ì°¨ì´ì ì ê´ì°°íì­ìì¤.</strong></p>
<p>ìë°ì´í¸ê° ì ì©ëë©´ <code>memoizedState</code> ë° <code>updateQueue</code>ì <code>baseState</code>ìì ìì± ìì ê°ì´ 1 ë¡ ë³ê²½ë©ëë¤. React ë ëí <code>ClickCounter</code> component ì¸ì¤í´ì¤ì ìíë¥¼ ìë°ì´í¸íìµëë¤.
ì´ ìì ìì íì ë ì´ì ìë°ì´í¸ê° ìì¼ë¯ë¡ <code>firstUpdate</code>ë null ìëë¤.</p>
<p>ê·¸ë¦¬ê³  ì¤ìíê²ë ì°ë¦¬ë <code>effectTag</code> ìì±ì ë³ê²½íìµëë¤. ê·¸ê²ì ë ì´ì <code>0</code>ì´ ìëë©°, ê°ì <code>4</code>ìëë¤. ì´ì§ìììë <code>100</code>ìëë¤. ì´ë ì¸ ë²ì§¸ ë¹í¸ê° ì¤ì ë¨ì ìë¯¸í©ëë¤. ì´ë <code>Update</code> <a href="https://github.com/facebook/react/blob/b87aabdfe1b7461e7331abb3601d9e6bb27544bc/packages/shared/ReactSideEffectTags.js?source=post_page---------------------------"><code>side-effect tag</code></a>ì ë¹í¸ìëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span></span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>Update</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="constant numeric binary js"><span>0b00000000100</span></span></span></div></pre>
<p>ê²°ë¡ ì ì¼ë¡ ë¶ëª¨ <code>ClickCounter</code> Fibre ë¸ëìì ìì í  ë React ë ì¬ì  ë³ì´(pre-mutation) ìëªì£¼ê¸° ë©ìëë¥¼ í¸ì¶íê³  state ë¥¼ ìë°ì´í¸íê³  ê´ë ¨ ë¶ìì©(side-effects)ì ì ìí©ëë¤.</p>
<h3>Reconciling children for the ClickCounter Fiber</h3>
<p>ìë£ëë©´ React ê° <a href="https://github.com/facebook/react/blob/340bfd9393e8173adca5380e6587e1ea1a23cefa/packages/react-reconciler/src/ReactFiberBeginWork.js?source=post_page---------------------------#L355"><code>finishClassComponent</code></a>ë¡ ë¤ì´ê°ëë¤. ì¬ê¸°ì React ë ì»´í¬ëí¸ ì¸ì¤í´ì¤ì <code>render</code> ë©ìëë¥¼ í¸ì¶íê³  í´ë¹ diffing ìê³ ë¦¬ì¦ì component ê° ë¦¬í´ í children ì ì ì©í©ëë¤. ê³ ê¸ ê°ìë ë¬¸ìì ì¤ëªëì´ ììµëë¤. <a href="https://reactjs.org/docs/reconciliation.html?source=post_page---------------------------#the-diffing-algorithm">ë¤ì</a>ì ê´ë ¨ ë¶ë¶ìëë¤.</p>
<blockquote>
<p>ê°ì ì íì ë ê°ì React DOM ììë¥¼ ë¹êµí  ë React ë ë ìì±ì ë³´ê³  ëì¼í ê¸°ë³¸ DOM ë¸ëë¥¼ ì ì§íê³  ë³ê²½ë ìì± ë§ ìë°ì´í¸í©ëë¤.</p>
</blockquote>
<p>ê·¸ë¬ë ì°ë¦¬ê° ë ê¹ì´ íê³  ë¤ë©´ ì¤ì ë¡ Fiber ë¸ëì React elements ë¥¼ ë¹êµíë¤ë ê²ì ì ì ììµëë¤. ê·¸ë¬ë íë¡ì¸ì¤ê° ë§¤ì° ì êµíê¸° ëë¬¸ì ì§ê¸ì ìì¸íê² ì¤ëªíì§ ìê² ìµëë¤. ëë child reconciliation ì ê³¼ì ì ì´ì ì ë ë³ëì ê¸ì ì¸ ê²ìëë¤.</p>
<blockquote>
<p>ì¤ì¤ë¡ ì¸ë¶ ì¬í­ì ë°°ì°ê³  ì¶ë¤ë©´ <a href="https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactChildFiber.js?source=post_page---------------------------#L732">reconcileChildrenArray</a> í¨ìë¥¼ íì¸íì­ìì¤. ì°ë¦¬ì ì´íë¦¬ì¼ì´ìììë <code>render</code> ë©ìëê° React ììì ë°°ì´ì ë°ííê¸° ëë¬¸ì <code>reconcileChildrenArray</code> í¨ìë¥¼ íì¸íì­ìì¤.</p>
</blockquote>
<p>ì´ ìì ìì ì´í´í´ì¼ í  ì¤ìí ë ê°ì§ê° ììµëë¤. <strong>ë¨¼ì </strong>, React ê° child reconciliation ë¥¼ ì§íí  ë <code>render</code> ë©ìëìì ë°í ë <strong>child React elements ì ëí Fibre ë¸ëë¥¼ ë§ë¤ê±°ë ìë°ì´í¸ í´ì¼í©ëë¤.</strong> <code>finishClassComponent</code> í¨ìë íì¬ Fibre ë¸ëì <code>ì²« ë²ì§¸ ììì ëí ì°¸ì¡°</code>ë¥¼ ë°íí©ëë¤. <code>nextUnitOfWork</code>ì í ë¹ëê³  ëì¤ì ìì ë£¨í(work loop)ìì ì²ë¦¬ë©ëë¤. <strong>ëì§¸</strong>, React ë parent ì ëí ìí í ììì ì¼ë¶ë¡ <strong>children ì props ì ìë°ì´í¸</strong>í©ëë¤. ì´ë¥¼ ìí´ <code>render</code> ë©ìëìì ë°í ë React ììì ë°ì´í°ë¥¼ ì¬ì©í©ëë¤.</p>
<p>ìë¥¼ ë¤ì´, React ê° <code>ClickCounter</code> fiber ì ëí children ì reconciles íê¸° ì ì <code>span</code> ììì í´ë¹íë Fibre ë¸ëê° ë¤ìê³¼ ê°ì´ íìë©ëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;stateNode</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta class instance constructor js"><span class="keyword operator new js"><span>new</span></span><span>&nbsp;</span><span class="entity name type instance js"><span>HTMLSpanElement</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;type</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>span</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;key</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>2</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;memoizedProps</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>children</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>0</span></span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;pendingProps</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>children</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>0</span></span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>ë³´ìë¤ìí¼, <code>memoizedProps</code> ë° <code>pendingProps</code>ì <code>children</code> ìì±ì ëª¨ë <code>0</code>ìëë¤. ì¬ê¸°ì <code>span</code> ììì ëí <code>render</code> ìì ë°í ë React ììì êµ¬ì¡°ê° ììµëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;ClickCounter&nbsp;ì&nbsp;render&nbsp;ë©ìë&nbsp;í¸ì¶&nbsp;íì&nbsp;ë¦¬í´ë&nbsp;span&nbsp;element</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;$$typeof</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="support class js"><span>Symbol</span></span><span class="meta brace round js"><span>(</span></span><span class="variable other object js"><span>react</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>element</span></span><span class="meta brace round js"><span>)</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;key</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>2</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;props</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;children</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>1</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;ref</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;type</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>span</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>ë³´ìë¤ìí¼, <strong>Fibre ë¸ëì props ê³¼ ë°í ë React element ìë ì°¨ì´ì ì´ ììµëë¤.</strong> alternate fiber ë¸ëë¥¼ ë§ëë ë° ì¬ì©ëë <code>createWorkInProgress</code> í¨ììì <strong>React ë React element ìì ìë°ì´í¸ ë íë¡í¼í°ë¥¼ fiber ë¸ëë¡ ë³µì¬í©ëë¤.</strong></p>
<p>ë°ë¼ì React ê° <code>ClickCounter</code> component ì ëí children ì reconciling í íìë <code>span</code> Fiber ë¸ëì <code>pendingProps</code>ê° ìë°ì´í¸ë©ëë¤. ê·¸ë¤ì React ììì ê°ê³¼ ì¼ì¹í©ëë¤ :</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;stateNode</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta class instance constructor js"><span class="keyword operator new js"><span>new</span></span><span>&nbsp;</span><span class="entity name type instance js"><span>HTMLSpanElement</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;type</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>span</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;key</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>2</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;memoizedProps</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>children</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>0</span></span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;pendingProps</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>children</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>1</span></span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;ìë°ì´í¸</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>ëì¤ì React ê° <code>span</code> fiber ë¸ëì ëí ììì ìí í  ë ê·¸ê²ë¤ì <code>memoizedProps</code>ì ë³µì¬íê³  DOM ì ìë°ì´í¸íê¸° ìí´ effects ë¥¼ ì¶ê°í©ëë¤.</p>
<p>React ê° ë ëë§ ë¨ê³ìì <code>ClickCounter</code> fiber ë¸ëì ëí´ ìííë ëª¨ë  ììì´ ê·¸ê²ìëë¤. ë²í¼ì <code>ClickCounter</code> component ì ì²« ë²ì§¸ ììì´ë¯ë¡ <code>nextUnitOfWork</code> ë³ìì í ë¹ë©ëë¤. ê·¸ê±¸ë¡ ëë´ì¼ í  ê²ì´ ìì¼ë¯ë¡, React ë Fibre ë¸ëì íì ë¡ ì´ëí  ê²ìëë¤. <a href="https://medium.com/react-in-depth/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react-e1c04700ef6e?source=post_page---------------------------">ì¬ê¸°</a>ì ì¤ëª ë ìê³ ë¦¬ì¦ì ë°ë¥´ë©´ ë¸ëì íì  ì´ë ë¡ì§ì <code>completeUnitOfWork</code> í¨ììì ë°ìí©ëë¤.</p>
<p>ì¬ê¸°ì <code>button</code> ì»´í¬ëí¸ë <code>beginWork()</code> ìí í ë³ëì ììì´ ìì¼ë¯ë¡ null ì´ ë¦¬í´ë  ê²ì´ë¤.
null ì´ ë¦¬í´ëë©´ ê³§ë°ë¡ <code>completeUnitOfWork</code> ë©ìëë¡ ë¤ì´ê°ì <code>completeWork</code> ë©ìëë¥¼ ì§ííê² ëë¤.
ê·¸ íì <code>sibling</code> ì ë¦¬í´íëë° ê·¸ê²ì´ <code>span</code> íê·¸ì´ë¤.</p>
<h3>Processing updates for the Span fiber</h3>
<p>ê·¸ëì ë³ì <code>nextUnitOfWork</code>ë <code>span</code> fiber ì alternate ì ê°ë¦¬í¤ê³  React ê° ììì ììí©ëë¤. <code>ClickCounter</code>ì ëí´ ìí ë ë¨ê³ì ì ì¬íê² <code>beginWork</code> í¨ìë¡ ììí©ëë¤.</p>
<p><code>span</code> ë¸ëê° <code>HostComponent</code> íìì´ê¸° ëë¬¸ì, ì´ë²ìë switch ë¬¸ìì React ê°ì´ ë¶ê¸°ë¥¼ ì·¨í©ëë¤ :</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>beginWork</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>current$$1</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>workInProgress</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta switch-statement js"><span class="keyword control switch js"><span>switch</span></span><span>&nbsp;</span><span class="punctuation definition switch-expression begin bracket round js"><span>(</span></span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>tag</span></span><span class="punctuation definition switch-expression end bracket round js"><span>)</span></span><span>&nbsp;</span><span class="punctuation definition section switch-block begin bracket curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>FunctionalComponent</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>ClassComponent</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>HostComponent</span><span class="punctuation definition section case-statement js"><span>:</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>updateHostComponent</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>current</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>}</span></span></span></div></pre>
<p><a href="https://github.com/facebook/react/blob/cbbc2b6c4d0d8519145560bd8183ecde55168b12/packages/react-reconciler/src/ReactFiberBeginWork.js?source=post_page---------------------------#L686"><code>updateHostComponent</code></a> í¨ììì ëë©ëë¤. í´ëì¤ êµ¬ì± ììì ëí´ í¸ì¶ ë <code>updateClassComponent</code> í¨ììì ë³ë ¬ì ë³¼ ì ììµëë¤. functional component ì ê²½ì° <code>updateFunctionComponent</code> ê°ë©ëë¤. ì´ë¬í ëª¨ë  ê¸°ë¥ì <a href="https://github.com/facebook/react/blob/1034e26fe5e42ba07492a736da7bdf5bf2108bc6/packages/react-reconciler/src/ReactFiberBeginWork.js?source=post_page---------------------------"><code>ReactFiberBeginWork.js</code></a> íì¼ìì ì°¾ì ì ììµëë¤.</p>
<h3>Reconciling children for the span fiber</h3>
<p>ì¬ê¸°ìë <code>updateHostComponent</code>ì <code>span</code> ë¸ëì ìë¬´ë° ì¤ìí ì¼ë ì¼ì´ëì§ ììµëë¤.</p>
<h3>Completing work for the Span Fiber node</h3>
<p><code>beginWork</code> ê° ëëë©´ ë¸ëë <code>completeWork</code> í¨ìë¡ ë¤ì´ê°ëë¤. íì§ë§ ê·¸ ì ì React ë span fiber ì <code>memoizedProps</code>ì ìë°ì´í¸ í´ì¼í©ëë¤. <code>ClickCounter</code> êµ¬ì± ììì ëí´ ììì reconciling í  ë React span fibre ë¸ëì <code>pendingProps</code>ê° ìë°ì´í¸ ëììì ââ ê¸°ìµí  ì ììµëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;stateNode</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta class instance constructor js"><span class="keyword operator new js"><span>new</span></span><span>&nbsp;</span><span class="entity name type instance js"><span>HTMLSpanElement</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;type</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>span</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;key</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>2</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;memoizedProps</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>children</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>0</span></span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;pendingProps</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>children</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>1</span></span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>ë°ë¼ì <code>beginWork</code> ê° span fiber ì ëí´ ìë£ëë©´ React <code>pendingProps</code> ê° <code>memoizedProps</code> ì ì¼ì¹í©ëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>performUnitOfWork</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>workInProgress</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;next&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>beginWork</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>current$$1</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;nextRenderExpirationTime</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>memoizedProps</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>pendingProps</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<p>ê·¸ë° ë¤ì ê¸°ë³¸ì ì¼ë¡ <code>beginWork</code> ìì ë³¸ ê²ê³¼ ë¹ì·í switch ë¬¸ì¸ <code>completeWork</code> í¨ìë¥¼ í¸ì¶í©ëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>completeWork</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>current</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>workInProgress</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta switch-statement js"><span class="keyword control switch js"><span>switch</span></span><span>&nbsp;</span><span class="punctuation definition switch-expression begin bracket round js"><span>(</span></span><span class="variable other object js"><span>workInProgress</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>tag</span></span><span class="punctuation definition switch-expression end bracket round js"><span>)</span></span><span>&nbsp;</span><span class="punctuation definition section switch-block begin bracket curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>FunctionComponent</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>ClassComponent</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>HostComponent</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>updateHostComponent</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>current</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;workInProgress</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>}</span></span></span></div></pre>
<p>ì°ë¦¬ì span Fibre ë¸ëë HostComponent ì´ë¯ë¡ <code>updateHostComponent</code> í¨ìë¥¼ ì¤íí©ëë¤. ì´ í¨ììì React ë ê¸°ë³¸ì ì¼ë¡ ë¤ìì ìíí©ëë¤.</p>
<ul>
<li>DOM ìë°ì´í¸ë¥¼ ì¤ë¹í©ëë¤.</li>
<li>span fiber ì updateQueue ì ê·¸ê²ë¤ì ì¶ê°íë¤.</li>
<li>DOM ì ìë°ì´í¸íë effect ì¶ê°</li>
</ul>
<p>ì´ë¬í ììì ìííê¸° ì ì span fiber ë¸ëë ë¤ìê³¼ ê°ìµëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;stateNode</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta class instance constructor js"><span class="keyword operator new js"><span>new</span></span><span>&nbsp;</span><span class="entity name type instance js"><span>HTMLSpanElement</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;type</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>span</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;effectTag</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>0</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;updateQueue</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>ììì´ ìë£ëë©´ ë¤ìê³¼ ê°ì´ ë³´ìëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;stateNode</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta class instance constructor js"><span class="keyword operator new js"><span>new</span></span><span>&nbsp;</span><span class="entity name type instance js"><span>HTMLSpanElement</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;type</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>span</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;effectTag</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>4</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;update</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;updateQueue</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span></span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>children</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>1</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta brace square js"><span>]</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p><code>effectTag</code> ë° <code>updateQueue</code> íëì ì°¨ì´ì ì íì¸íì­ìì¤. ê·¸ê²ì ë ì´ì <code>0</code>ì´ ìëë©°, ê°ì <code>4</code>ìëë¤. ì´ì§ìììë <code>100</code>ìëë¤. ì´ë ì¸ ë²ì§¸ ë¹í¸ê° ì¤ì ë¨ì ìë¯¸í©ëë¤. ì´ë ìë°ì´í¸ side-effect tag ì ë¹í¸ìëë¤. ì´ê²ì ë¤ì <code>ì»¤ë° ë¨ê³</code>ìì React ê° ì´ ë¸ëì ëí´ ìíí´ì¼íë ì ì¼í ìììëë¤. <code>updateQueue</code> íëë ìë°ì´í¸ì ì¬ì©ë  íì´ë¡ëë¥¼ ë³´ì í©ëë¤.</p>
<p>React ê° <code>ClickCounter</code> ì ê·¸ children ì ì²ë¦¬íë©´ <code>ë ëë§ ë¨ê³</code>ê° ìë£ë©ëë¤. ìì± ë ëì²´ í¸ë¦¬ë¥¼ <code>FiberRoot</code> ì <code>finishedWork</code> ìì±ì í ë¹ í  ì ììµëë¤. ì´ê²ì ìë¡ì´ tree ê° íë©´ì ë¿ë ¤ì ¸ì¼ í©ëë¤. <code>ë ëë§ ë¨ê³</code> ì§íì ë°ë¡ ì²ë¦¬íê±°ë ëì¤ì React ê° ë¸ë¼ì°ì ì ìí´ ì£¼ì´ì§ ìê°ì ì í ë  ì ììµëë¤.</p>
<h3>Effects list</h3>
<p>ì°ë¦¬ì ê²½ì° <code>span</code> ë¸ëì <code>ClickCounter</code> ì»´í¬ëí¸ë side effects ê° ìì¼ë¯ë¡ React ë <code>Span</code> Fiber ë¸ëì ëí ë§í¬ë¥¼ <code>HostFiber</code> ì <code>firstEffect</code> ìì±ì ì¶ê°í©ëë¤.
React ë <a href="https://github.com/facebook/react/blob/d5e1bf07d086e4fc1998653331adecddcd0f5274/packages/react-reconciler/src/ReactFiberScheduler.js?source=post_page---------------------------#L999"><code>completeUnitOfWork</code></a> í¨ììì effects list ì ìì±í©ëë¤. ë¤ìì <code>span</code> ë¸ëì íì¤í¸ë¥¼ ìë°ì´í¸ì effect ë¥¼ ê°ì§ Fiber tree ì <code>ClickCounter</code>ìì hooks ë¥¼ í¸ì¶íë í¸ë¦¬ì ììëë¤.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/ho_blog/static/effect-linearList01-8b614849fb0fcdb5b5102ac4b5e27bf5-67524.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 460px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 58.91304347826086%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAB4klEQVQoz31Sz2sTQRTev0AEr94E8e7Ziyii0IuHqqUHLxEPXgxVEamFeJCKaKka1BoQLx4MHjzUHtocNNJg7S1tMdo0SePuNia72Zmd3dkf7z1ntw3YQ/N4vBl4873H932jvV/avvOyOlnY+Nl2iSgEjJCQDg7EJNPQJvLVs9ny6Zvl+cU1rjeNesOsN3YaDbAN7JsobAwEBl6SoU//j0XUPlfMmQ+/X3zcbBmMUILHKHANvasu6DnIu+QYKrFvgPUHrDb0tsHZQSkS8N4YiFWR80/dR+fF88v9Jxfd2VHx+IJYeqPIMA/8iIAojkKKQvR5MqXb0nYpYBwpsMhf7WcOOxPHefYYu3WCZQ5Zr64zIE9IiwUA+6UIvMFmVHMpWivJhdmg9DoozclPD+XCDGxWLEEt012t2etNpnd9GAiGvKcdqGoUxNxS52Rh/Uy2PPZgZeTu8ujUd+6FCTIKoFPfD1b7FXmVKYvY0kmYuXe1kdtfMtMrV6aWx3MV7qkWxp0tlK42xNCkWG2l/EaHvtVkVYemTXEcwd8tZUTiMw2LlNuPIn2dY4sFKL+l1SKYv5Tzu92h4NQ/5VlvTHPunbSvHbFvHE2cHwg8FJy+8Iv3ee6Umx/n0+fEs0vK5L1PSvQP6O+F/yCtUyYAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="effect-linearList01"
        title=""
        src="/ho_blog/static/effect-linearList01-8b614849fb0fcdb5b5102ac4b5e27bf5-67524.png"
        srcset="/ho_blog/static/effect-linearList01-8b614849fb0fcdb5b5102ac4b5e27bf5-15e19.png 148w,
/ho_blog/static/effect-linearList01-8b614849fb0fcdb5b5102ac4b5e27bf5-ea422.png 295w,
/ho_blog/static/effect-linearList01-8b614849fb0fcdb5b5102ac4b5e27bf5-67524.png 460w"
        sizes="(max-width: 460px) 100vw, 460px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>ë¤ìì í¨ê³¼ê°ìë ë¸ëì ì í ëª©ë¡ìëë¤.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/ho_blog/static/effect-linearList02-def4fa8ffdc9665b60f924eb7b3f0aa5-b088a.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 529px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 17.76937618147448%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7UlEQVQI12P4////79+/799/cPnK5Rs3bn769Bko8u/fPzj55s3rG9evX758+dGjR/9RAcOxK2+vPfj088f3z58+fvvx89fbp7+v7ft9/cDvK3uB5J+bh358fv/py7cvX799/fTx941Dv6/u/X11H5jcy2Cffyip4+z3n/++fP315f//TweXvg9l+Jgp+qlM80Myz4d4tj93T/7/8/P/zy9/X97+kCbwqUjlU4n6xwKFT8WqDIVTLvWtugN0w98/v0FeuLb/c5vz18nhX2clfekL+NLr9/f1A4gj/315+2Vi6NepUV+nx36dFgNEAGJ7xAftZoqqAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="effect-linearList02"
        title=""
        src="/ho_blog/static/effect-linearList02-def4fa8ffdc9665b60f924eb7b3f0aa5-b088a.png"
        srcset="/ho_blog/static/effect-linearList02-def4fa8ffdc9665b60f924eb7b3f0aa5-28aeb.png 148w,
/ho_blog/static/effect-linearList02-def4fa8ffdc9665b60f924eb7b3f0aa5-4828a.png 295w,
/ho_blog/static/effect-linearList02-def4fa8ffdc9665b60f924eb7b3f0aa5-b088a.png 529w"
        sizes="(max-width: 529px) 100vw, 529px"
      />
    </span>
  </span>
  
  </a>
    </p>
<h2>Commit phase</h2>
<p>ì´ ë¨ê³ë <a href="https://github.com/facebook/react/blob/95a313ec0b957f71798a69d8e83408f40e76765b/packages/react-reconciler/src/ReactFiberScheduler.js?source=post_page---------------------------#L2306"><code>completeRoot</code></a> í¨ìë¡ ììí©ëë¤. ìììíê¸° ì ì <code>FiberRoot</code> ì <code>finishedWork</code> ìì±ì <code>null</code> ë¡ ì¤ì í©ëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="text plain null-grammar"><span>root.finishedWork&nbsp;=&nbsp;null;</span></span></div></pre>
<p>ì²« ë²ì§¸ <code>ë ëë§ ë¨ê³</code>ì ë¬ë¦¬ <code>ì»¤ë° ë¨ê³</code>ë í­ì ëê¸°ìì´ë¯ë¡ <code>HostRoot</code>ë¥¼ ìì íê² ìë°ì´í¸íì¬ ì»¤ë° ììì´ ììëììì ëíë¼ ì ììµëë¤.</p>
<p>ì»¤ë° ë¨ê³ììë React ê° DOM ì ìë°ì´í¸íê³  post mutation lifecycle ë©ìë ì¸ <code>componentDidUpdate</code> ë¥¼ í¸ì¶í©ëë¤. ì´ë¥¼ ìí´ ì´ì  <code>ë ëë§ ë¨ê³</code>ìì ìì± í effects list ì ê²í íê³  ì ì©í©ëë¤.</p>
<p>ì°ë¦¬ë <code>span</code> ë° <code>ClickCounter</code> ë¸ëì <code>ë ëë§ ë¨ê³</code>ìì ë¤ìê³¼ ê°ì effect ë¥¼ ì ìíìµëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span><span>&nbsp;type</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;ClickCounter</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;effectTag</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>5</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span><span>&nbsp;type</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>span</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;effectTag</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>4</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p><code>ClickCounter</code> ì í¨ê³¼ íê·¸ ê°ì <code>5</code> ëë 2 ì§ìë¡ <code>101</code>ì´ë©° í´ëì¤ êµ¬ì± ììì ê²½ì° ê¸°ë³¸ì ì¼ë¡ <code>componentDidUpdate</code> ë¼ì´í ì¬ì´í´ ë©ìëë¡ ë³íëë ìë°ì´í¸ ììì ì ìí©ëë¤. ëí ìµíì ë¹í¸ë ë ëë§ ë¨ê³ììì´ fiber ë¸ëì ëí ëª¨ë  ììì´ ìë£ëììì ìë¦¬ê¸° ìí´ ì¤ì ë©ëë¤.
<code>span</code> ì ëí í¨ê³¼ íê·¸ì ê°ì <code>4</code> ëë 2 ì§ìë¡ <code>100</code>ì´ë©° host component DOM ìë°ì´í¸ì <code>update</code> ììì ì ìí©ëë¤. <code>span</code> ììì ê²½ì°, React ë ììì <code>textContent</code>ë¥¼ ìë°ì´í¸í´ì¼í©ëë¤.</p>
<h3>Applying effects</h3>
<p>React ê° ì´ë»ê² ê·¸ effects ë¥¼ ì ì©íëì§ ë´ìë¤. effects ë¥¼ ì ì©íë ë° ì¬ì©ëë <code>commitRoot</code> í¨ìë ì¸ ê°ì§ íì í¨ìë¡ êµ¬ì±ë©ëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>commitRoot</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>root</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>finishedWork</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>commitBeforeMutationLifecycles</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>commitAllHostEffects</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="variable other object js"><span>root</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>current</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;finishedWork</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>commitAllLifeCycles</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<p>ê° íì í¨ìë effects list ì ë°ë³µíê³  effects íìì íì¸íë ë£¨íë¥¼ êµ¬íí©ëë¤. í¨ìì ëª©ì ê³¼ ê´ë ¨ë effect ë¥¼ ë°ê²¬íë©´ ì ì©í©ëë¤. ì¬ê¸°ìë <code>ClickCounter</code> êµ¬ì± ìììì <code>componentDidUpdate</code> ë¼ì´í ì¬ì´í´ ë©ìëë¥¼ í¸ì¶íê³  <code>span</code> ììì íì¤í¸ë¥¼ ìë°ì´í¸í©ëë¤.
ì²« ë²ì§¸ í¨ì ì¸ <a href="https://github.com/facebook/react/blob/fefa1269e2a67fa5ef0992d5cc1d6114b7948b7e/packages/react-reconciler/src/ReactFiberCommitWork.js?source=post_page---------------------------#L183"><code>commitBeforeMutationLifeCycles</code></a> ë <code>Snapshot</code> effect ë¥¼ ì°¾ê³  <code>getSnapshotBeforeUpdate</code> ë©ìëë¥¼ í¸ì¶í©ëë¤. ê·¸ë¬ë <code>ClickCounter</code> êµ¬ì± ììì ì´ ë©ìëë¥¼ êµ¬ííì§ ììì¼ë¯ë¡ React ë ë ëë§ ë¨ê³ìì effect ë¥¼ ì¶ê°íì§ ìììµëë¤. ê·¸ëì ì°ë¦¬ì ê²½ì°ì´ í¨ìë ìë¬´ ê²ëíì§ ììµëë¤.</p>
<h3>DOM updates</h3>
<p>ë¤ì React ë <code>commitAllHostEffects</code> í¨ìë¡ ì´ëíë¤. ì¬ê¸°ì React ê° <code>span</code> ììì íì¤í¸ë¥¼ <code>0</code>ìì <code>1</code>ë¡ ë³ê²½í©ëë¤. í´ëì¤ êµ¬ì± ììì í´ë¹íë ë¸ëì DOM ìë°ì´í¸ê° ìì¼ë¯ë¡ <code>ClickCounter</code> fiber ìë ìë¬´ ììë ìíëì§ ììµëë¤.
í¨ìì ìì§ë ì¬ë°ë¥¸ effect ì íìë¥¼ ì ííê³  í´ë¹ ììì ì ì©íë¤ë ê²ìëë¤. ì¬ê¸°ìë <code>span</code> ììì íì¤í¸ë¥¼ ìë°ì´í¸ í´ì¼íë¯ë¡ ì¬ê¸°ìì <code>Update</code> ë¶ê¸°ë¥¼ ê°ì ¸ìµëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>updateHostEffects</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta switch-statement js"><span class="keyword control switch js"><span>switch</span></span><span>&nbsp;</span><span class="punctuation definition switch-expression begin bracket round js"><span>(</span></span><span>primaryEffectTag</span><span class="punctuation definition switch-expression end bracket round js"><span>)</span></span><span>&nbsp;</span><span class="punctuation definition section switch-block begin bracket curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>Placement</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>PlacementAndUpdate</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>Update</span><span class="punctuation definition section case-statement js"><span>:</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type var js"><span>var</span></span><span>&nbsp;current&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>nextEffect</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>alternate</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>commitWork</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>current</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;nextEffect</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>break</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>Deletion</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition section switch-block end bracket curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<p><code>commitWork</code> ë¡ ì´ëíë©´ ê²°êµ­ <code>updateDOMProperties</code> í¨ìë¡ ë¤ì´ê°ë¤. ë ë ë¨ê³ ëì Fibre ë¸ëì ì¶ê° ë <code>updateQueue</code> íì´ë¡ëë¥¼ ê°ì ¸ ìì <code>span</code> ììì <code>textContent</code> ìì±ì ìë°ì´í¸í©ëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>updateDOMProperties</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>domElement</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>updatePayload</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>for</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="storage type var js"><span>let</span></span><span>&nbsp;i&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>0</span></span><span class="punctuation terminator statement js"><span>;</span></span><span>&nbsp;i&nbsp;</span><span class="keyword operator comparison js"><span>&lt;</span></span><span>&nbsp;</span><span class="variable other object js"><span>updatePayload</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property js"><span>length</span></span><span class="punctuation terminator statement js"><span>;</span></span><span>&nbsp;i&nbsp;</span><span class="keyword operator assignment compound js"><span>+=</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>2</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;updateQueue:&nbsp;[&quot;children&quot;,&nbsp;&quot;1&quot;],</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>propKey</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;updatePayload</span><span class="meta brace square js"><span>[</span></span><span>i</span><span class="meta brace square js"><span>]</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>propValue</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;updatePayload</span><span class="meta brace square js"><span>[</span></span><span>i&nbsp;</span><span class="keyword operator js"><span>+</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>1</span></span><span class="meta brace square js"><span>]</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>propKey&nbsp;</span><span class="keyword operator comparison js"><span>===</span></span><span>&nbsp;</span><span class="constant other js"><span>STYLE</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>else</span></span><span>&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>propKey&nbsp;</span><span class="keyword operator comparison js"><span>===</span></span><span>&nbsp;</span><span class="constant other js"><span>DANGEROUSLY_SET_INNER_HTML</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>else</span></span><span>&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>propKey&nbsp;</span><span class="keyword operator comparison js"><span>===</span></span><span>&nbsp;</span><span class="constant other js"><span>CHILDREN</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>setTextContent</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>domElement</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;propValue</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>else</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<p>DOM ìë°ì´í¸ê° ì ì©ë í React ë <code>finishedWork</code> í¸ë¦¬ë¥¼ <code>HostRoot</code> ì í ë¹í©ëë¤. alternate í¸ë¦¬ë¥¼ íì¬(current)ë¡ ì¤ì í©ëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="variable other object js"><span>root</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>current</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;finishedWork</span></span></div></pre>
<h3>Calling post mutation lifecycle hooks</h3>
<p>ë§ì§ë§ ë¨ì ê¸°ë¥ì <a href="https://github.com/facebook/react/blob/d5e1bf07d086e4fc1998653331adecddcd0f5274/packages/react-reconciler/src/ReactFiberScheduler.js?source=post_page---------------------------#L479"><code>commitAllLifecycles</code></a> ìëë¤. ì¬ê¸°ì React ë post mutational lifecycle methods ë¥¼ í¸ì¶í©ëë¤. ë ëë§ ë¨ê³ìì React ë <code>Update</code> effect ë¥¼ ClickCounter êµ¬ì± ììì ì¶ê°íìµëë¤. ì´ê²ì <code>commitAllLifecycles</code> í¨ìê° ì°¾ê³  <code>componentDidUpdate</code> ë©ìëë¥¼ í¸ì¶íë effects ì¤ íëìëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>commitAllLifeCycles</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>finishedRoot</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>while</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>nextEffect&nbsp;</span><span class="keyword operator comparison js"><span>!==</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>effectTag</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>nextEffect</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>effectTag</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>effectTag&nbsp;</span><span class="keyword operator bitwise js"><span>&amp;</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>Update&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;Callback</span><span class="meta brace round js"><span>)</span><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>current</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>nextEffect</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>alternate</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>commitLifeCycles</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>finishedRoot</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;current</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;nextEffect</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>effectTag&nbsp;</span><span class="keyword operator bitwise js"><span>&amp;</span></span><span>&nbsp;Ref</span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>commitAttachRef</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>nextEffect</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nextEffect&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>nextEffect</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>nextEffect</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<p>í¨ìë ëí <a href="https://reactjs.org/docs/refs-and-the-dom.html?source=post_page---------------------------">refs</a>ë¥¼ ìë°ì´í¸íì§ë§, ì°ë¦¬ë ì´ ê¸°ë¥ì ê°ì§ê³  ìì§ ìê¸° ëë¬¸ì ì¬ì©ëì§ ìì ê²ì´ë¤. ì´ ë©ìëë <a href="https://github.com/facebook/react/blob/e58ecda9a2381735f2c326ee99a1ffa6486321ab/packages/react-reconciler/src/ReactFiberCommitWork.js?source=post_page---------------------------#L351"><code>commitLifeCycles</code></a> í¨ììì í¸ì¶ë©ëë¤.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>commitLifeCycles</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>finishedRoot</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>current</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta switch-statement js"><span class="keyword control switch js"><span>switch</span></span><span>&nbsp;</span><span class="punctuation definition switch-expression begin bracket round js"><span>(</span></span><span class="variable other object js"><span>finishedWork</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>tag</span></span><span class="punctuation definition switch-expression end bracket round js"><span>)</span></span><span>&nbsp;</span><span class="punctuation definition section switch-block begin bracket curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>FunctionComponent</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>ClassComponent</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>instance</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>finishedWork</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>stateNode</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="variable other object js"><span>finishedWork</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>effectTag</span></span><span>&nbsp;</span><span class="keyword operator bitwise js"><span>&amp;</span></span><span>&nbsp;Update</span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>current&nbsp;</span><span class="keyword operator comparison js"><span>===</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>instance</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>componentDidMount</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>else</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>instance</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>componentDidUpdate</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>prevProps</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;prevState</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span>HostComponent</span><span class="punctuation definition section case-statement js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span class="keyword operator spread js"><span>...</span></span><span class="meta brace curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span class="keyword operator spread js"><span>...</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>}</span></span></span></div></pre>
<p>React ê° ì²ì ë ëë§ ë êµ¬ì± ììì ëí´ <code>componentDidMount</code> ë©ìëë¥¼ í¸ì¶íë í¨ììì ì ì ììµëë¤.
ê·¸ë¦¬ê³  ê·¸ê² ë¤ì¼!</p>
<h2>ì ë¦¬</h2>
<h3>Render Phase</h3>
<ul>
<li>commit phase ììì í´ì¼í  effect ëª©ë¡(ì í)ì ë§ë¤ê¸° ìí´ fiber nodeë¥¼ ììíë¤.</li>
</ul>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>performUnitOfWork</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>workInProgress</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;childrenì&nbsp;ëí&nbsp;í¬ì¸í°&nbsp;ëë&nbsp;null</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type var js"><span>let</span></span><span>&nbsp;next&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>beginWork</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>workInProgress</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>next&nbsp;</span><span class="keyword operator comparison js"><span>===</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;ë&nbsp;ì´ìì&nbsp;ììì´&nbsp;ììë&nbsp;completeUnitOfWork&nbsp;-&gt;&nbsp;completeWorkë¥¼&nbsp;ìí</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;completeUnitOfWorkë&nbsp;siblingì´&nbsp;ììë&nbsp;return&nbsp;sibling&nbsp;í&nbsp;ë¤ì&nbsp;beginWork&nbsp;ì§í</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;siblingë&nbsp;ìì&nbsp;ìì&nbsp;ë¶ëª¨ë¡&nbsp;ì¬ë¼ê°ì&nbsp;completeUnitOfWork&nbsp;ë´ë¶ì&nbsp;ìë&nbsp;completeWorkë¥¼&nbsp;ìí</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;next&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>completeUnitOfWork</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>workInProgress</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;next</span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<ul>
<li>ì <code>performUnitOfWork</code> ë¥¼ while íë©´ì fiberë¥¼ ìì°¨ì ì¼ë¡ ì ì©íë¤. </li>
<li>
<p><code>beginWork()</code> ë¶í° ìì. ì¬ê¸°ì  ì»´í¬ëí¸ì íìì ë°ë¼ componentë¥¼ update ì§ííë¤. </p>
<ul>
<li>í´ëì¤ ì»´í¬ëí¸ì ê²½ì°ìë <code>updateClassComponent()</code> ë¤ì ë©ìë ì¤í, ì¸ì¤í´ì¤ë¥¼ create ëë updateë¥¼ ì§ííë¤. í¹í updateì fiber nodeë¥¼ ê°ì§ê³  instanceë¥¼ updateíë¤.</li>
<li><code>finishClassComponent()</code> ì¬ê¸°ìë childrenë¤ì reconciliationì ì§ííë¤. ì¦, ë¶ëª¨ì render ì´í React elementì ì´ì ì fiber nodeë¥¼ ë¹êµ í fiber nodeë¥¼ ìë°ì´í¸ íë¤. </li>
<li><code>finishClassComponent()</code> ì´íì <code>beginWork()</code> ë¦¬í´ì¼ë¡ë childê° ìì ê²½ì° ì²«ë²ì§¸ child ê° ë¦¬í´ ìë ê²½ì° null ì´ ë¦¬í´</li>
</ul>
</li>
<li>ì²«ë²ì§¸ childì¸ button ì ë¤ì <code>beginWork()</code> -> childê° ìê¸° ëë¬¸ì ë°ë¡ null ë¦¬í´,  <code>completeUnitOfWork()</code> ì§í í completeWork() ì§í. </li>
<li><code>span</code> íê·¸ì sibling íì¸ (<code>completeUnitOfWork()</code> ë©ìëìì ìí)</li>
<li><code>span</code> íê·¸ì <code>beginWork()</code> ìí í, null ë¦¬í´, <code>completeUnitOfWork()</code> ì§í í <code>completeWork()</code> ì§í. </li>
<li><code>span</code> íê·¸ì <code>completeWork()</code> ì§í ì, <code>span</code> fiberì <code>effectTag</code> ì <code>updateQueue</code> ë¥¼ ìë°ì´í¸ ì§í. </li>
<li>effects listë¥¼ êµ¬ì±í´ì <code>commit phase</code>ë¡ ëê¹ ( root -> span -> ClickCounter )</li>
</ul></div><hr style="margin-bottom:1.53rem;" data-reactid="9"/><div style="display:flex;margin-bottom:3.825rem;" data-reactid="10"><img src="/ho_blog/static/img_profile.1f79e005.jpeg" alt="Merlin.ho" style="margin-right:0.765rem;margin-bottom:0;width:3.06rem;height:3.06rem;" data-reactid="11"/><p data-reactid="12"><!-- react-text: 13 -->Written by <!-- /react-text --><strong data-reactid="14">Merlin.ho</strong><!-- react-text: 15 --> who lives and works in Pangyo building useful things.<!-- /react-text --><!-- react-text: 16 --> <!-- /react-text --></p></div></div><span style="display:block;clear:both;" data-reactid="17"> </span></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-a16cf49ffcd7b97d28a9.js","99219681209289":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","107818501498521":"component---src-templates-blog-post-js-dabe65ee189101b630a0.js","35783957827783":"component---src-pages-index-js-4a72a400e6141dde0d21.js","60335399758886":"path----557518bd178906f8d58a.js","210333531512890":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","111898030062913":"path---call-stack-ae217c5d96088f3ccd78.js","140444808481594":"path---docker-depolyment-4012246536442f60159d.js","67469829867878":"path---hello-monad-59e45b33826bee6342ec.js","163121481561693":"path---hello-web-server-50ce4db03e3201a76414.js","275591574691347":"path---lazy-evaluation-b06a6cf4962e0032b9fb.js","240236403038750":"path---maintainable-javascript-event-handling-08483da9a7c1874195de.js","163591510377563":"path---maintainable-javascript-no-null-comparison-cd4e4ae619857122decb.js","78697077285144":"path---maintainable-javascript-user-error-throwing-2f9594d962f6c72f1e44.js","219926873231408":"path---refactoring-complex-refactoring-3bde085886c272fceff0.js","122409595676540":"path---think-high-order-function-58f7199816abbe8ab707.js","5023129853458":"path---value-and-reference-6083800bc1607839d93d.js","105843449635648":"path---experience-monorepo-481c39ada3235001112a.js","174342234436027":"path---hello-middleware-214cfa12d70783762915.js","60702703624353":"path---hello-react-e0cd56e5890daca606f6.js","51191554927023":"path---javascript-basic-1-9a67a2cd34c9412b299b.js","73704410068446":"path---javascript-object-a5446c0327b623ee17b9.js","24443999554804":"path---javascript-prototype-dd176c5979078c57a58c.js","203204203537797":"path---react-hook-50e414c02d6c6eb1c2e5.js","257369935370228":"path---refactoring-moving-between-object-9e40449234c2cb6b787d.js","79996153856445":"path---refactoring-method-cleanup-46236c286e9dee8da3fa.js","246346007348531":"path---tail-recursion-112d6f6c158ce2ab06a7.js","75445273333793":"path---react-fiber-react-fiber-01-9817de484f8f2d85ddfe.js","142221992286439":"path---ui-unit-testing-a749535a7628a8651417.js","88166365168691":"path---try-catch-8e0ec6acd7f1cfd8bb47.js","177359372373161":"path---webpack-config-d646c3ec578c78b12b66.js","59645336058927":"path---hello-flow-f30a55513f3646cb48d1.js","90837107504198":"path---hello-oop-8753bd908c30244d5ee3.js","231909470762625":"path---refactoring-concise-conditionals-d2ab514478d45d06c674.js","58827738984857":"path---refactoring-organization-data-1-3cae99d84479a08a4086.js","234343465206083":"path---sop-and-cors-dns-rebinding-0d28de5fe72d23bb7185.js","55049869895717":"path---hello-docker-05e42a31d1677fb4a2e0.js","160582500480188":"path---hello-webpack-b0122eda8ae66d76c639.js","23603272521549":"path---make-promise-2d29a8c204a414548e31.js","45440482069588":"path---react-hook-hood-hook-198451376f5f09ad8447.js","201965495218339":"path---refactoring-organization-data-2-6725e1fa3585396087cf.js","122362222700994":"path---refactoring-5ee2d02ba04bdb575764.js","239272989053013":"path---refactoring-generalization-processing-e71d2e5e4b0e785fd2f5.js","262138261438389":"path---hello-rxjs-862697598103e600f28f.js","71473981912016":"path---javascript-pattern-648c1f680f29c9828e5a.js","147139475262338":"path---react-fiber-react-fiber-02-ae5013af7830f5bad8d7.js","120945912393580":"path---refactoring-simplifying-method-calls-294a8dadb4d3828fd246.js","43779473796627":"path---react-fiber-react-fiber-03-29e733efaa17068c8d71.js","132591256042226":"path---hello-mobx-01735f8a0f592b5e0358.js","134631639062865":"path---build-react-bdc86e6d7eed10152aa4.js","142629428675168":"path---index-2dbf06633d0de1b21f6b.js","114276838955818":"component---src-layouts-index-js-60e98b905b7a1c56256e.js"}/*]]>*/</script><script>
            
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto');
      }
      </script><script>/*<![CDATA[*/["/ho_blog/commons-241c3561f1c9cf4619a9.js","/ho_blog/app-a16cf49ffcd7b97d28a9.js","/ho_blog/path---react-fiber-react-fiber-03-29e733efaa17068c8d71.js","/ho_blog/component---src-templates-blog-post-js-dabe65ee189101b630a0.js","/ho_blog/component---src-layouts-index-js-60e98b905b7a1c56256e.js"].forEach(function(s){document.write('<script src="'+s+'" defer></'+'script>')})/*]]>*/</script></body></html>