{"componentChunkName":"component---src-templates-post-tsx","path":"/docker-depolyment.md/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"docker-depolyment\" style=\"position:relative;\"><a href=\"#docker-depolyment\" aria-label=\"docker depolyment permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker Depolyment</h1>\n<hr>\n<h2 id=\"blue-green-배포-개념\" style=\"position:relative;\"><a href=\"#blue-green-%EB%B0%B0%ED%8F%AC-%EA%B0%9C%EB%85%90\" aria-label=\"blue green 배포 개념 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>blue-green 배포 개념</h2>\n<p>로드발란서를 앞단에 하나를 두고 v1 버젼인 블루(가칭) 라는 앱을 띄운다. 그러다가 나는 v2 버젼인 그린(가칭)을 무중단 방식으로 업데이트를 진행하고 싶다. <br>\n그럴때 그린을 로드발란서에 등록을 시킨다. <br>\n그러면 블루와 그린을 로드발란싱을 할텐데 그린이 완전히 정상작동을 하였을때 v1 버젼인 블루를 죽이는 방식이다.</p>\n<h2 id=\"why-needs\" style=\"position:relative;\"><a href=\"#why-needs\" aria-label=\"why needs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>why needs?</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fb095609940c67b4165035ab4468af02/6e8bc/img_greenBlue.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.241032998565274%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6UlEQVQoz42SW2sTURSF58m/4R8w+B/EZ0H66IuoVSj0oYIPiiAVGy/4Jm1R8EbrJaQKIiKF0qJYBK1SKzGmUKPNNDOazHSSmWQmc/ucc5pLLwbcsNj7zKy9zuy1R6nVanRgWVa3LpVKlMtlmVVVRdd1mQU0TdvD70DxPA8B13UlOmfbtnEcR+Z6u240ttBsNnb0bO9TkBHTjXhbvStuPvzAsfMvGErPUtls/pOjdIo/6gae22pr9kTFrbqm03Idjg7fZ9+BEfYfGmW1qNF0bKpVA8Mw8H2/J7i8MMfriQu8y9wm9lzCKKb4Y41fqs6l8XnSd+YlefjqLAcHJjk8OIWqW/KZ7wcEQdD9CMWKQ74tTsLqA8pvJ1j8vML3XI5UKsXYWJrl3Dr5NU2SjVqTjUod3bAJw2jPuEJUKRPwZfocXD7CzyunWPndwLZMstkZPi0t7WhY+PqMqTc3mHk/ju1a7PZfCsrK9TDXi1A327615DbFhsVIwkcRd+eucfbeAKOZ02jVEtZmDdM0qVQq8i+QIwdRhJ9cEgg/kuwn/kXinIwkvAyTW4MwlOSXH6e59epiInwd0zYkzw9C/OS94AdR3Nvy/4XwTWwz6MtQTjzO0w/HH+UZyhYYeV7gTCbP4NMCJ59soV/PX1aFHfZlVEZhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"구성\"\n        title=\"구성\"\n        src=\"/static/fb095609940c67b4165035ab4468af02/799d3/img_greenBlue.png\"\n        srcset=\"/static/fb095609940c67b4165035ab4468af02/00d96/img_greenBlue.png 148w,\n/static/fb095609940c67b4165035ab4468af02/0b23c/img_greenBlue.png 295w,\n/static/fb095609940c67b4165035ab4468af02/799d3/img_greenBlue.png 590w,\n/static/fb095609940c67b4165035ab4468af02/2a3d6/img_greenBlue.png 885w,\n/static/fb095609940c67b4165035ab4468af02/ae92f/img_greenBlue.png 1180w,\n/static/fb095609940c67b4165035ab4468af02/6e8bc/img_greenBlue.png 1394w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<hr>\n<h2 id=\"backend-environment\" style=\"position:relative;\"><a href=\"#backend-environment\" aria-label=\"backend environment permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BackEnd Environment</h2>\n<ul>\n<li>노트북 : 맥북</li>\n<li>도커 호스트 : virtual box ubuntu or mac</li>\n<li>도커 컨테이너 : node express server , nginx-proxy , mongodb</li>\n</ul>\n<hr>\n<h2 id=\"폴더-구조\" style=\"position:relative;\"><a href=\"#%ED%8F%B4%EB%8D%94-%EA%B5%AC%EC%A1%B0\" aria-label=\"폴더 구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>폴더 구조</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">├── dockerfile\n│   ├── Dockerfile_express      ## express 용 서버 이미지 소스파일\n├── template                    ## 템플릿 소스\n├── server                      ## 서버소스\n│   ├── server.js\n├── .dockerignore\n├── check.sh                    ## 배포용 sh\n├── docker-compose.yml          ## docker 컨테이너들의 환경설정을 모아둔곳 한번에 서버들을 손쉽게 실행시킬 수 있다.\n├── package.json                ## app server 컨테이너 안에 들어가 관련 패키지 설치\n  </code></pre></div>\n<hr>\n<h2 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h2>\n<ol>\n<li>맥북 - virtual box 공유 폴더 구성</li>\n<li>폴더 구성 </li>\n<li>ubuntu 에서 nginx-proxy 이미지 다운</li>\n<li>ubuntu 에서 node 이미지를 기반으로 express Dockerfile_express 작성 및 빌드</li>\n<li>docker-compose.yml 작성</li>\n<li>/etc/hosts 파일 수정</li>\n<li>check.sh 현재 돌아가는 도커 확인하고 새로운 도커 띄우고 현재 돌아가는 도커 죽이는 쉘 스크립트 작성</li>\n<li>테스트</li>\n</ol>\n<p><strong>만약 mac 에서 테스트를 한다면 2번부터 보시면 됩니다.</strong></p>\n<hr>\n<h2 id=\"procedure\" style=\"position:relative;\"><a href=\"#procedure\" aria-label=\"procedure permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>procedure</h2>\n<ol>\n<li>버츄어 박스에 공유 폴더 설정\n참고 : <a href=\"http://theniceguy.tistory.com/13\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://theniceguy.tistory.com/13</a></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\">## 우분투에 공유폴더 마운트 </span>\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">mount</span> --types vboxsf blog_project blog_project</code></pre></div>\n<ul>\n<li>로컬 blog<em>project 폴더를 버츄어박스의 blog\\</em>proect 폴더랑 연결</li>\n<li>버츄어 박스 내의 blog_proect 폴더안에는 도커에서 필요한 소스파일 및 설정파일들이 담겨져 있음.</li>\n<li>로드밸런싱을 위한 nginx-proxy 이미지 다운 받기 </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\">## nginx-proxy 이미지 다운 받기 </span>\n$ docker pull jwilder/nginx-proxy </code></pre></div>\n<ul>\n<li>사실 여기서 받지 않아도  docker-compose.yml 파일에 설정이 되어있어서 docker-compose up 하면 자동으로 pull을 받게 된다.</li>\n<li>해당 이미지는 도커 젠을 기반으로 만들어진 nginx-proxy로 로드발란싱의 기능이 있는 nginx applicaion에 도커 젠 기능을 추가 해서 넣은 이미지</li>\n<li>해당 이미지를 사용하게 되면 도커 젠이 도커 데몬을 바라보고 있다가 컨테이너의 런 , 스탑 등의 이벤트를 감지, 해당 컨테이너 정보를 수집 해서 추가 작업을 할 수 있게 끔 도와준다. 여기서 추가작업은 nginx reverse proxy config 작업을 자동으로 수행할 수 있게 도와준다.</li>\n<li>여기서 호스트의 docker.sock을 nginx-proxy 내부로 들고가야 하는데 이유는 호스트와 통신을 해야하기 때문이다. 호스트 서버에서 발생되는 도커 데몬의 이벤트를 바라보고 있다가 정보를 잘 받을수 있도록 통신을 해야한다.</li>\n<li>여기서 nginx-proxy에 등록될 app 들은 VIRTUAL_HOST라는 환경변수를 등록 해야한다.</li>\n<li>nginx 의 가상 호스트 정보는 <a href=\"https://opentutorials.org/module/384/4529\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://opentutorials.org/module/384/4529</a> 여길 참조</li>\n<li>express 도커서버를 위한 도커파일 작성</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token comment\">## express 를 위한 도커파일</span>\n<span class=\"token keyword\">FROM</span> node<span class=\"token punctuation\">:</span>alpine\n<span class=\"token keyword\">MAINTAINER</span>  merlin@merlin.com\n\n<span class=\"token keyword\">RUN</span> mkdir <span class=\"token punctuation\">-</span>p /app\n<span class=\"token keyword\">WORKDIR</span> /app\n<span class=\"token keyword\">COPY</span> package*.json ./\n<span class=\"token keyword\">RUN</span>  npm install\n\n<span class=\"token keyword\">EXPOSE</span> 3000</code></pre></div>\n<ol start=\"4\">\n<li>도커파일을 express 이미지로 빌드.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker build -t blog_express:v1 -f ./dockerfile/Dockerfile_express <span class=\"token builtin class-name\">.</span></code></pre></div>\n<ol start=\"5\">\n<li>모아둔 이미지들을 실행할 수 있도록 docker compose 작성</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\">#docker-compose.yml</span>\n\n<span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.2'</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">app_blue</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> blog_express<span class=\"token punctuation\">:</span>v1\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> nginx<span class=\"token punctuation\">-</span>proxy\n      <span class=\"token punctuation\">-</span> mongo<span class=\"token punctuation\">-</span>db\n    <span class=\"token key atrule\">working_dir</span><span class=\"token punctuation\">:</span> /app/\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> 8888<span class=\"token punctuation\">:</span><span class=\"token number\">3000</span>\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span> \n      <span class=\"token punctuation\">-</span> dbconnection\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> VIRTUAL_HOST=nodeapp.local\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> bind\n        <span class=\"token key atrule\">source</span><span class=\"token punctuation\">:</span> ./template\n        <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> /app/template\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> bind\n        <span class=\"token key atrule\">source</span><span class=\"token punctuation\">:</span> ./server\n        <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> /app/server\n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> npm start\n  \n  <span class=\"token key atrule\">app_green</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> blog_express<span class=\"token punctuation\">:</span>v1\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> nginx<span class=\"token punctuation\">-</span>proxy\n      <span class=\"token punctuation\">-</span> mongo<span class=\"token punctuation\">-</span>db\n    <span class=\"token key atrule\">working_dir</span><span class=\"token punctuation\">:</span> /app/\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span> \n      <span class=\"token punctuation\">-</span> dbconnection\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> VIRTUAL_HOST=nodeapp.local\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> bind\n        <span class=\"token key atrule\">source</span><span class=\"token punctuation\">:</span> ./template\n        <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> /app/template\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> bind\n        <span class=\"token key atrule\">source</span><span class=\"token punctuation\">:</span> ./server\n        <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> /app/server \n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> npm start\n\n  <span class=\"token key atrule\">nginx-proxy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jwilder/nginx<span class=\"token punctuation\">-</span>proxy\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> 8080<span class=\"token punctuation\">:</span><span class=\"token number\">80</span>\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span> \n      <span class=\"token punctuation\">-</span> dbconnection\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/tmp/docker.sock<span class=\"token punctuation\">:</span>ro\n  \n  <span class=\"token key atrule\">mongo-db</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mongo\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> 9999<span class=\"token punctuation\">:</span><span class=\"token number\">27017</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> db<span class=\"token punctuation\">-</span>data<span class=\"token punctuation\">:</span>/data/db\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span> \n      <span class=\"token punctuation\">-</span> dbconnection\n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> mongod <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>dbpath \"/data/db\" \n    \n<span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">db-data</span><span class=\"token punctuation\">:</span>\n\n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span> \n  dbconnection<span class=\"token punctuation\">:</span></code></pre></div>\n<p>** 브라우저에서 접근할시 VIRTUAL_HOST 에 설정했던 이름으로 접근할 것 <br>\nnginx 설정에 server_name이 VIRTUAL_HOST 에 설정했던 값이 박혀있기에 nginx는 해당 이름으로 접근할때 반응하게 된다. <br>\n해서 /etc/hosts 설정은 필수</p>\n<ol start=\"6\">\n<li>/etc/hosts 파일 수정</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token number\">0.0</span>.0.0   nodeapp.local</code></pre></div>\n<ol start=\"7\">\n<li>블루-그린 배포를 위한 쉘 스크립트 작성</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\">#check.sh</span>\n\n<span class=\"token comment\">#!/bin/sh</span>\n\n<span class=\"token assign-left variable\">EXIST_BLUE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>docker <span class=\"token function\">ps</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> app_blue<span class=\"token variable\">)</span></span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> -z <span class=\"token string\">\"<span class=\"token variable\">$EXIST_BLUE</span>\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    docker-compose up -d app_blue\n    docker-compose stop app_green\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"run app_blue!!\"</span>\n<span class=\"token keyword\">else</span>\n    docker-compose up -d app_green\n    docker-compose stop app_blue\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"run app_green!!\"</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<ul>\n<li>check.sh 를 작성해서 app_blue가 실행했을 경우에는 app_green이 실행 후 app_blue 를 중지.</li>\n<li>app_green 이 실행했을 경우에는 app_blue를 실행 후 app_green 를 중지.</li>\n<li>test</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 처음에는 app_blue를 띄운다.</span>\n$ docker-compose up -d app_blue\n\n<span class=\"token comment\"># 그 다음부턴 무중단으로 .check.sh 를 실행</span>\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">sh</span> check.sh</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/52861d8be6168118711b8bb27f0629b8/17cfb/img_developTest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.46730462519936%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABh0lEQVQoz2VS23KbMBT0vzRO7GAwCITFVdyJuBhIPW1e8/8fsT2S65mkfdgRQrs7uzraPVsMvGoRqxEsLfDDEnBFC9ltaNWK9m1B2YzgokBeKTT9FVnRQ9YKYVwilR0CIXG0OV4sH7sXlyPYZrjvE5y+hZ+vSMZPOMkCP6ogkgohrf5F4tUJDbRYwzrfv59fmTE7nALsTkRY519Q7YJ5/Ak1LJimFV0/Ii/fTLKLzGGxwIj+hTZ5wCQ8njmKaYEk9OsNcTGARQ2EVLgkNWwmwOKYBD72R+8/g6/p7pXJ0F8n8N8bTk2NvdeAVR/w8g1OkJuEp7OgyjnirPmWStfnEZ27whibygcilPWImuDQwf7oUrIKdTsaokUiTdbCfthgexGeKOnTwTUG+j8LM9jEvRtSFUl31XQzGQ8k9ihVjul6g6Spejw1RL1qQz1xQVehJ62nG0al2TOe/a1sB0i7AdV1gyg77K0QQdKjUTcM8808m8dw1PRuTKtuQkdPKs5aiLQ2CR/P5g+GpQrISKB2ywAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"테스트 결과 화면\"\n        title=\"테스트 결과 화면\"\n        src=\"/static/52861d8be6168118711b8bb27f0629b8/799d3/img_developTest.png\"\n        srcset=\"/static/52861d8be6168118711b8bb27f0629b8/00d96/img_developTest.png 148w,\n/static/52861d8be6168118711b8bb27f0629b8/0b23c/img_developTest.png 295w,\n/static/52861d8be6168118711b8bb27f0629b8/799d3/img_developTest.png 590w,\n/static/52861d8be6168118711b8bb27f0629b8/2a3d6/img_developTest.png 885w,\n/static/52861d8be6168118711b8bb27f0629b8/ae92f/img_developTest.png 1180w,\n/static/52861d8be6168118711b8bb27f0629b8/17cfb/img_developTest.png 1254w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","excerpt":"Docker Depolyment blue-green 배포 개념 로드발란서를 앞단에 하나를 두고 v1 버젼인 블루(가칭) 라는 앱을 띄운다. 그러다가 나는 v…","tableOfContents":"<ul>\n<li>\n<p><a href=\"/docker-depolyment.md/#docker-depolyment\">Docker Depolyment</a></p>\n<ul>\n<li><a href=\"/docker-depolyment.md/#blue-green-%EB%B0%B0%ED%8F%AC-%EA%B0%9C%EB%85%90\">blue-green 배포 개념</a></li>\n<li><a href=\"/docker-depolyment.md/#why-needs\">why needs?</a></li>\n<li><a href=\"/docker-depolyment.md/#backend-environment\">BackEnd Environment</a></li>\n<li><a href=\"/docker-depolyment.md/#%ED%8F%B4%EB%8D%94-%EA%B5%AC%EC%A1%B0\">폴더 구조</a></li>\n<li><a href=\"/docker-depolyment.md/#summary\">Summary</a></li>\n<li><a href=\"/docker-depolyment.md/#procedure\">procedure</a></li>\n</ul>\n</li>\n</ul>","fields":{"slug":"/docker-depolyment.md/"},"frontmatter":{"title":"Docker Depolyment","date":"Jan 20, 2018","tags":["undefined"],"keywords":["Merlin Tech Blog","Merlin.ho"],"update":"Jan 01, 0001"}}},"pageContext":{"slug":"/docker-depolyment.md/","series":[],"lastmod":"0001-01-01"}}}