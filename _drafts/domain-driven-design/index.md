---
title: 도메인 주도 설계
date: "2020-12-15T10:00:03.284Z"
tags:
  - javascript
  - DDD
keywords:
  - DDD
---

> 이 글은 "도메인 주도 설계 철저 입문 책"을 읽고 정리한 내용입니다. 문제가 될 시 삭제하겠습니다.

## 도메인 주도 설계란?

- 도메인은 영역이라는 뜻이다. 프로그램에서는 프로그램이 쓰이는 대상 분야 이다.
- 도메인에 중요한 점은 도메인에 포함되는 것이 무엇인가 하는 것이다.
- 도메인에 포함되는 개념은 시스템의 대상 분야가 무엇인지에 따라 달라진다.
- 모델은 현실에 일어나는 사건 혹은 개념을 추상화한 개념이다.
- 사건 혹은 개념을 추상화 하는 작업을 모델링이라고 한다.
- 모델링의 결과를 모델이라고 한다.
- 도메인 개념을 모델링한 모델을 도메인 모델이라고 한다.
- 도메인 모델을 소프트웨어 형태의 동작하는 모듈로 나타낸 것이 도메인 객체다.

### 도메인 주도 설계 정리

- 사건 또는 개념을 추상화 하는 작업 -> 모델링
- 모델링의 결과 -> 모델
- 도메인 모델을 소프트웨어 형태의 동작하는 모듈 -> 도메인 객체

## 값 객체

- 프로그래밍 언어에서 원시 데이터 타입만 이용하는 것이 아니라 특유의 값을 정의 내릴때 사용하는 객체를 값 객체라고 한다.
- 객체 지향에서는 일반적으로 클래스를 사용해서 값 객체를 나타낸다.
- 객체이기도 하면서 동시에 값이기도 하다.
- 시스템 특유의 값을 나타내는 객체다.
- 값 객체는 데이터와 더불어 그 데이터에 대한 행동을 한곳에 모아둠으로써 자신만의 규칙을 갖는 도메인 객체가 된다.

### 값 객체 성질

- 값은 변화하지 않은 성질을 갖는다.
- 변수에 대입은 값을 수정하는 과정이 아닌 대팅을 통해 변수의 내용이 수정될 뿐 값 자체가 수정되는 것은 아니다.
- 교환 가능하다.
- 값은 값 자신이 아니라 값을 구성하는 속성을 통해 비교된다. (등가성을 비교할 수 있다. ex. === )

## 엔티티

- 엔티티 또한 도메인 모델을 구현한 도메인 객체다.
- 값 객체와 차이는 동일성을 통해 식별이 가능한지 아닌지에 있다.
- 엔티티는 속성이 아닌 동일성으로 식별되는 객체다.

### 엔티티 성질

- 값 객체는 불변성이지만 엔티티는 가변성을 갖는 객체다.
- 값 객체는 속성이 같다면 같은것으로 취급되었지만 엔티티는 속성이 같아도 두 엔티티를 서로 다른 것으로 취급힌다.
- 서로 다른 엔티티를 구별하는데는 식별자가 쓰인다.
- 엔티티는 동일성을 지니고 있다. (ex. 사용자 명이 바뀌더라도  같은 사용자로 인식해야 한다.)

### 엔티티 판단 기준

- 생애주기를 가지며 연속성을 갖는 개념은 엔티티로 판단하기에 문제가 없다.
- 같은 대상이라도 어떤 환경에 있느냐에 따라 모델링 방법이 달라진다.

## 도메인 서비스

- 서비스는 클라이언트를 위해 무언가를 해주는 객체를 말한다.
- 서비스는 크게 두가지로 나뉜다. 도메인을 위한 서비스 와 애플리케이션을 위한 서비스
- 도메인 서비스란 값 객체나 엔티티로 구현하기 어색한 행동을 해결해 주는 객체다.
  - User 엔티티에 사용자명의 중복 여부를 확인하는 행위는 어색하다.
- 도메인 서비스는 자신의 행동을 바꿀 수 있는 인스턴스만의 값을 갖지 않는다는 점에서 값 객체나 엔티티와 다르다.
- 엔티티나 값 객체에 정의하기 부자연스러운 처리는 도메인 서비스에 정의하면 된다.
- 우선 엔티티나 값 객체에 정의하는 것이 좋으며, 도메인 서비스에 행위를 구현하는 것은 가능한한 피해야 한다.
- 도메인 서비스에는 데이터 스토어를 직접 다루는 내용이 들어가지 않도록 하자. ( 간적접으로 리포지토리 패턴으로 이러한 문제를 해결하자.)
- 도메인에는 도메인 객체에 구현하기 자연스럽지 못한 행위가 있다.

## 리포지토리

- 데이터와 관계된 처리를 분리하자.
- 리포지토리는 데이터 보관창고를 의미한다.
- 메모리에 로드된 데이터는 프로그램을 종료하면 사라져 버리기 때문에 데이터스토어에 저장을 해야한다.
- 리포지토리는 데이터를 저장하고 복원하는 처리를 추상화 하는 객체다.
- 리포지토리의 책임은 도메인 객체를 저장하고 복원하는 퍼시스턴시다.
- 객체의 퍼시스턴시와 관련된 처리를 리포지토리에 맡기면 비즈니스 로직을 더욱 순수하게 유지할 수 있다.
- 도메인의 지식이 리포지토리로 넘어가선 안된다. 만약 리포지토리로 어쩔 수 없이 넘어가게 된다면 도메인 지식이 도메인 객체에서 보여지도록 해야한다. (ex. 리포지토리에 넘어가는 매개변수를 통해서라도)
- 리포지토리에 정의되는 행위는 객체의 저장 및 복원에 대한 것이다.
- 불필요하게 수정 메서드가 정의된 리포지토리는 옳지 않다. 객체가 저장하고 있는 데이터를 수정하려면 애초부터 객체 자신에게 맡기는 것이 옳다.
- 객체를 생성하는 처리도 리포지토리에 정의해서는 안된다.

## 애플리케이션 서비스

- 애플리케이션은 유스케이스를 구현하는 객체라고 할 수 있다.
- 애플리케이션은 일반적으로 이용자의 목적에 부응하는 프로그램을 의미한다. 목표는 이용자의 필요를 만족시키고 목적을 달성하게 하는 것이다.
- 도메인 객체의 힘을 하나로 엮어 올바른 방향으로 이끌어야 한다.
- 애플리케이션 서비스에서 도메인 객체를 직접 리턴(공개) 하지 않고(비공개) 클라이언트에 데이터 전송을 위한 객체(DTO, data transfer object)를 만들어 여기에 데이터를 옮겨 넣어 반환한다.
- DTO를 사용하면 클라이언트는 도메인 객체의 메서드를 직접 호출할 수 없다.
- 커맨드 객체를 사용하면 애플리케이션 메서드에서 파라미터가 추가되더라도 메서드의 시그니처(메서드의 리턴타입과 매개변수)를 바꿀 필요가 없게 한다.
- 커맨드 객체는 어떤 처리의 퍼사드 역할을 한다. (퍼사드는 복잡한 코드를 간략화해 노출하는 인터페이스를 의미한다.)
- 애플리케이션 서비스는 도메인 객체가 수행하는 태스크를 조율하는 데만 전념해야 한다.
- 도메인 규칙은 도메인 객체에 구현하고 애플리케이션 서비스는 이 도메인 객체를 사용하는 역할만 맡는다.
- 응집도는 모듈의 책임 범위가 얼마나 집중 되어 있는지를 나타내는 척도다.
- 응집도가 높으면 모듈이 하나의 관심사에 집중하고 있다는 의미이므로 모듈의 견고성, 신뢰성, 재사용성, 가독성의 측면에서 바람직하다.
- 응집도를 측정하는 방법에는 모든 인스턴스 변수가 모든 메서드에서 사용돼야 한다는 관점에서 인스턴스 변수의 개수와 메서드의 수를 통해 응집도를 계산한다.
- 응집도를 높히려면 서로 관계 된 것들끼리 분리를 해두면 응집도가 높아진다.

### 서비스란 무엇인가?

- 서비스는 클라이언트를 위해 무언가를 해주는 존재다.
- 예를 들어 사용자명 중복 확인은 도메인의 활동이다. 이를 제공하는 서비스 객체는 도메인 서비스, 도메인 서비스는 도메인 지식을 나타낸 도메인 객체다.
- 애플리케이션은 이용자의 문제를 해결하기 위한 것이다. 이들 처리는 애플리케이션 고유의 행동이며 이들이 정의된 서비스도 애플리케이션의 서비스가 된다.
- 서비스는 자신의 행동을 변화시키는 것을 목적으로 하는 상태를 갖지 않는다.

### 애플리케이션 서비스 정리

- 애플리케이션 서비스는 도메인 객체를 다루는데 전념하며 유스케이스를 구현한다.
- 애플리케이션 서비스를 구현할 때는 도메인 규칙에 대한 기술이 포함되지 않게 주의한다.

## 의존 관계 역전 원칙

## 소프트웨어 시스템 구성하기

## 팩토리 패턴

## 데이터 무결성

## 애그리게이트

## 명세

## 아키텍쳐